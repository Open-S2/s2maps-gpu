"use strict";(this.webpackChunk=this.webpackChunk||[]).push([[225],{225:(e,t,n)=>{n.r(t),n.d(t,{default:()=>k});var r=n(840),i=n.n(r),o=n(465),a=n(243),s=n(89),u=n(272);function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}}(e,t)||h(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){if(e){if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function v(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function d(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){v(o,r,i,a,s,"next",e)}function s(e){v(o,r,i,a,s,"throw",e)}a(void 0)}))}}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t){return y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},y(e,t)}function m(e,t){if(t&&("object"===c(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return b(e)}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function w(e){return w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},w(e)}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var k=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");Object.defineProperty(e,"prototype",{value:Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),writable:!1}),t&&y(e,t)}(j,e);var t,r,o,c,v,k,g,C=(k=j,g=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=w(k);if(g){var n=w(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return m(this,e)});function j(e,t,n,r){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,j),_(b(i=C.call(this,e)),"id",void 0),_(b(i),"parent",void 0),_(b(i),"_canvas",void 0),_(b(i),"_canDraw",!1),_(b(i),"_interactive",!1),_(b(i),"_scrollZoom",!0),_(b(i),"renderNextFrame",!1),_(b(i),"mousePosition",[0,0]),_(b(i),"injectionQueue",[]),_(b(i),"resizeQueued",null),_(b(i),"dragPan",void 0),_(b(i),"canMove",!0),_(b(i),"canZoom",!0),_(b(i),"mouseMoved",!0),_(b(i),"currAnimFunction",void 0),_(b(i),"currFeature",null),i.id=n,i.parent=r,i._canvas=t;var o=e.style,a=e.webworker,s=e.interactive,u=e.scrollZoom,c=e.canMove,l=e.canZoom;return i.webworker=!!a,s&&(i._interactive=s),u&&(i._scrollZoom=u),!1===c&&(i.canMove=!1),!1===l&&(i.canZoom=!1),i._buildPaint(e,o),i}return t=j,r=[{key:"_buildPaint",value:(v=d(i().mark((function e(t,n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._createPainter(t);case 2:if(!e.sent){e.next=8;break}return this._setupCanvas(),this.style=new u.Z(t,this),e.next=8,this.setStyle(n,!1);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return v.apply(this,arguments)})},{key:"_createPainter",value:(c=d(i().mark((function e(t){var r,o,a,s,u,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.contextType,a=0,3===r?(o=this._canvas.getContext("webgpu"),a=3):(s={powerPreference:"high-performance",antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,alpha:!0,stencil:!0},2===r?(o=this._canvas.getContext("webgl2",s),a=2):(o=this._canvas.getContext("webgl",s),a=1)),o){e.next=7;break}return e.abrupt("return",!1);case 7:if(3!==a){e.next=14;break}return e.next=10,n.e(449).then(n.bind(n,449)).then((function(e){return e.Painter}));case 10:u=e.sent,this.painter=new u,e.next=18;break;case 14:return e.next=16,Promise.resolve().then(n.bind(n,330)).then((function(e){return e.Painter}));case 16:c=e.sent,this.painter=new c(o,a,t);case 18:return e.abrupt("return",!0);case 19:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"delete",value:function(){this.tileCache.deleteAll(),this.style={},this._draw=function(){},this.painter.delete()}},{key:"jumpTo",value:function(e,t,n){this.projector.setPosition(e,t,n),this.render()}},{key:"animateTo",value:function(e,t){var n=this,r=new s.Z(this.projector,t);("flyTo"===e?r.flyTo():r.easeTo())&&(this.currAnimFunction=function(e){return n._animate(r,.001*e)},this.render())}},{key:"setStyle",value:(o=d(i().mark((function e(t,n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._canDraw=!1,this.tileCache.deleteAll(),e.next=4,this.style.buildStyle(t);case 4:this._canDraw=!0,this.projector.setStyleParameters(this.style,n),this.render();case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"updateStyle",value:function(e){}},{key:"clearSource",value:function(e){this.tileCache.forEach((function(t){t.deleteSources(e)})),this.style.deleteSources(e),this.painter.dirty=!0,this.render()}},{key:"resetSource",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this._resetTileCache(e.map((function(e){return e[0]})),t,n);r.length&&(this.webworker?postMessage({mapID:this.id,type:"tilerequest",tiles:r,sources:e}):window.S2WorkerPool.tileRequest(this.id,r,e)),this.painter.dirty=!0,this.render()}},{key:"addLayer",value:function(e,t){var n=this._resetTileCache(null,!1,!0);this.style.addLayer(e,t,n),this.render()}},{key:"removeLayer",value:function(e){var t=this.style.removeLayer(e);this.tileCache.forEach((function(e){e.removeLayer(t)})),this.render()}},{key:"reorderLayers",value:function(e){this.style.reorderLayers(e),this.tileCache.forEach((function(t){t.reorderLayers(e)})),this.render()}},{key:"setMoveState",value:function(e){this.canMove=!!e}},{key:"setZoomState",value:function(e){this.canZoom=!!e}},{key:"updateCompass",value:function(e,t){var n=this.projector;this.currAnimFunction=null,n.setCompass(n.bearing+(0|e),n.pitch+(0|t)),this.render()}},{key:"mouseupCompass",value:function(){var e=this,t=this.projector,n=t.bearing;if(n){var r=n>=-10&&n<=10?0:n<=-167.5?-180:n>=167.5?180:void 0;if(!isNaN(r)){var i=new s.Z(t,{duration:1,bearing:r});i.compassTo(),this.currAnimFunction=function(t){return e._animate(i,.001*t)},this.render()}}}},{key:"resetCompass",value:function(){var e=this,t=this.projector,n=t.bearing,r=t.pitch,i=n&&n>90?1.75:1,o=new s.Z(t,{duration:i,bearing:0,pitch:n?null:0|r});o.compassTo(),this.currAnimFunction=function(t){return e._animate(o,.001*t)},this.render()}},{key:"resize",value:function(e,t){this.resizeQueued={width:e,height:t},this.render()}},{key:"screenshot",value:function(){var e=this;requestAnimationFrame((function(){if(e._fullyRenderedScreen()){var t=e.painter.getScreen();e.webworker?postMessage({type:"screenshot",screen:t}):e.parent.dispatchEvent(new CustomEvent("screenshot",{detail:t}))}else e.screenshot()}))}},{key:"injectData",value:function(e){"flush"===e.type?this._injectData(e):this.injectionQueue.push(e),this.render()}},{key:"colorMode",value:function(e){this.painter.setColorMode(e),this.render()}},{key:"onCanvasMouseMove",value:function(e,t){this.style&&this.style.interactive&&!this.projector.dirty&&(this.mousePosition[0]=e,this.mousePosition[1]=t,this.mouseMoved=!0,this.render())}},{key:"onTouchStart",value:function(e){if(this.dragPan.onTouchStart(e),!(!this.style.interactive||this.projector.dirty||e.length>1)){var t=e[0],n=t.x,r=t.y;this.mousePosition[0]=n,this.mousePosition[1]=r,this.mouseMoved=!0,this.render()}}},{key:"navEvent",value:function(e,t,n){var r=this,i=this.projector.zoom+("zoomIn"===e?1:-1),o=new s.Z(this.projector,{duration:1.5,zoom:i,lon:t,lat:n});o.zoomTo(),this.currAnimFunction=function(e){return r._animate(o,.001*e)},this.render()}},{key:"_contextLost",value:function(){}},{key:"_contextRestored",value:function(){}},{key:"_resetTileCache",value:function(e,t,n){var r=this,i=this.getTiles(),o=[];return this.tileCache.forEach((function(a,s){if(t||i.includes(s)){var u=a.id,c=a.face,l=a.zoom,h=a.i,f=a.j,v=a.bbox,d=a.division,p=a.size;o.push({id:u,face:c,zoom:l,i:h,j:f,bbox:v,division:d,size:p}),!n&&e&&a.deleteSources(e)}else r.tileCache.delete(s)})),o}},{key:"_setupCanvas",value:function(){var e=this,t=e._canvas,n=e._interactive,r=e._scrollZoom;t.addEventListener("webglcontextlost",e._contextLost,!1),t.addEventListener("webglcontextrestored",e._contextRestored,!1);var i=e.dragPan=new a.Z;n&&(r&&(i.zoomActive=!0),i.addEventListener("move",e._onMovement.bind(e)),i.addEventListener("swipe",e._onSwipe.bind(e)),i.addEventListener("zoom",(function(){e._onZoom(i.zoom)})),i.addEventListener("click",e._onClick.bind(e)),i.addEventListener("doubleClick",e._onDoubleClick.bind(e))),e._resizeCamera(t.width,t.height)}},{key:"_handleFeatureChange",value:function(e){var t=this.currFeature;this.currFeature=e,this.webworker?postMessage({type:"mouseleave",feature:t}):(t&&this.parent.dispatchEvent(new CustomEvent("mouseleave",{detail:t})),this._canvas.style.cursor="default"),this.webworker?postMessage({type:"mouseenter",feature:e}):e&&(this.parent.dispatchEvent(new CustomEvent("mouseenter",{detail:e})),this._canvas.style.cursor=e.__cursor||"default"),this.render()}},{key:"_resize",value:function(){var e=this._canvas,t=this.resizeQueued;if(t){this.currAnimFunction=null;var n=t.width,r=t.height;e.width=n,e.height=r,this._resizeCamera(n,r),this.resizeQueued=null}}},{key:"_onClick",value:function(e){var t=e.detail,n=this.projector,r=this.currFeature,i=this.parent,o=t.posX,a=t.posY,s=l(n.cursorToLonLat(o,a),2),u=s[0],c=s[1];this.webworker?postMessage({type:"click",feature:r,lon:u,lat:c}):(i.info&&i.info.click(r,u,c),i.dispatchEvent(new CustomEvent("click",{detail:{feature:r,lon:u,lat:c}})))}},{key:"_onDoubleClick",value:function(e){var t=e.detail,n=t.posX,r=t.posY,i=l(this.projector.cursorToLonLat(n,r),2),o=i[0],a=i[1];this.navEvent("zoomIn",o,a)}},{key:"_onPositionUpdate",value:function(){var e=this.projector,t=e.zoom,n=e.lon,r=e.lat;this.webworker?postMessage({type:"pos",zoom:t,lon:n,lat:r}):this.parent.dispatchEvent(new CustomEvent("pos",{detail:{zoom:t,lon:n,lat:r}}))}},{key:"_onCanvasMouseMove",value:function(){var e,t,n=(e=this.painter.context).getFeatureAtMousePosition.apply(e,function(e){if(Array.isArray(e))return f(e)}(t=this.mousePosition)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||h(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());if(!n&&this.currFeature)this._handleFeatureChange(null);else if(n&&(!this.currFeature||this.currFeature.__id!==n)){var r,i=!1,o=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=h(e))){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(this.tilesInView);try{for(o.s();!(r=o.n()).done;){var a=r.value.findInteractiveFeature(n);if(a){this._handleFeatureChange(a),i=!0;break}}}catch(e){o.e(e)}finally{o.f()}!i&&this.currFeature&&this._handleFeatureChange(null)}}},{key:"_onZoom",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.dragPan.clear(),this.canZoom&&(this.currAnimFunction=null,e&&this.projector.onZoom(e,t,n),this.render())}},{key:"_onMovement",value:function(e){if(this.canMove){var t=this.projector,n=this.dragPan,r=n.movementX,i=n.movementY;t.onMove(r,i),this.render()}}},{key:"_onSwipe",value:function(e){var t=this;if(this.canMove){var n=this.projector,r=this.dragPan,i=r.movementX,o=r.movementY,a=new s.Z(n,{duration:1.75});a.swipeTo(i,o),this.currAnimFunction=function(e){return t._animate(a,.001*e)},this.render()}}},{key:"_animate",value:function(e,t){var n=this.dragPan.mouseActive;this.render(),(e.increment(t)||n)&&(this.currAnimFunction=null)}},{key:"_updatePainter",value:function(){this.painter.dirty=!0,this.render()}},{key:"render",value:function(){var e=this;e._canDraw&&(e.renderNextFrame||(e.renderNextFrame=!0,requestAnimationFrame((function(t){if(e.renderNextFrame=!1,e.timeCache&&e.timeCache.animate(t,e._updatePainter.bind(e)),e.currAnimFunction&&e.currAnimFunction(t),e.resizeQueued&&e._resize(),e.injectionQueue.length){var n=e.injectionQueue.pop();e._injectData(n),e.render()}var r=e.projector.dirty;r&&(e.render(),e._onPositionUpdate()),e._draw(),e.mouseMoved&&!r&&(e.mouseMoved=!1,e._onCanvasMouseMove())}))))}}],r&&p(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),j}(o.Z)}}]);