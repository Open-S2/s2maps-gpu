"use strict";(this.webpackChunk=this.webpackChunk||[]).push([[189],{189:(e,t,i)=>{i.r(t),i.d(t,{default:()=>y});var r=i(53);const o={source:"precision highp float;attribute vec2 aG;attribute vec2 aH;attribute vec2 aI;attribute vec2 aJ;attribute vec2 aK;attribute vec2 aL;attribute vec2 aM;attribute float aN;attribute vec4 aO;varying float aA;varying float aB;varying float aC;varying vec2 aD;varying vec4 aE;uniform bool uP;uniform bool uQ;uniform bool uR;uniform vec2 uS;uniform vec2 uT;uniform vec4 uU;uniform bool uV;uniform float uW;uniform sampler2D uX;uniform float uY;uniform vec4 uZ;uniform vec4 ua;uniform float ub;uniform float uc[6];uniform vec4 ud;uniform vec4 ue;uniform mat4 uf;float STtoUV(float s){if(s>=0.5) return(1./3.)*(4.*s*s-1.);else return(1./3.)*(1.-4.*(1.-s)*(1.-s));}vec4 STtoXYZ(in vec2 st){st/=8192.;int face=int(uc[0]);vec3 xyz;vec2 uv=vec2(STtoUV(uc[2]*st.x+uc[3]),STtoUV(uc[4]*st.y+uc[5]) );if(face==0) xyz=vec3(uv.x,uv.y,1.);else if(face==1) xyz=vec3(1.,uv.y,-uv.x);else if(face==2) xyz=vec3(-uv.y,1.,-uv.x);else if(face==3) xyz=vec3(-uv.y,-uv.x,-1.);else if(face==4) xyz=vec3(-1.,-uv.x,uv.y);else xyz=vec3(uv.x,-1.,uv.y);xyz=normalize(xyz)*6371.0088;return vec4(xyz,1.);}vec4 getPosLocal(in vec2 pos){pos/=8192.;vec2 deltaBottom=ud.zw-ud.xy;vec2 deltaTop=ue.zw-ue.xy;vec2 bottomPosS=ud.xy+deltaBottom*pos.x;vec2 topPosS=ue.xy+deltaTop*pos.x;vec2 deltaS=topPosS-bottomPosS;vec2 res=bottomPosS+deltaS*pos.y;return vec4(res,0.,1.);}vec4 getPos(in vec2 pos){if(uc[1]<12.){return uf*STtoXYZ(pos);}else{return getPosLocal(pos);}}vec4 getZero(){if(uc[1]<12.){return uf*vec4(0.,0.,0.,1.);}else{return vec4(0.,0.,1.,1.);}}int AND(int n1,int n2){float v1=float(n1);float v2=float(n2);int byteVal=1;int result=0;for(int i=0;i<32;i++){bool keepGoing=v1>0.0||v2>0.0;if(keepGoing){bool addOn=mod(v1,2.0)>0.0 && mod(v2,2.0)>0.0;if(addOn) result+=byteVal;v1=floor(v1/2.0);v2=floor(v2/2.0);byteVal*=2;}else{return result;}}return result;}int rightShift(int num,float shifts){return int(floor(float(num)/pow(2.0,shifts)));}void main(){if(aH.x<uU.x||aH.x>uU.z||aH.y<uU.y||aH.y>uU.w) return;vec4 glPos=getPos(aH);bool shouldDraw=true;float strokeWidth;vec4 inputID;if(!uQ){int id=int(aN);ivec3 colorID=ivec3(float(AND(id,255)),float(AND(rightShift(id,8.),255)),float(rightShift(id,16.)));inputID=texture2D(uX,vec2(glPos/2.+0.5));if(colorID !=ivec3(inputID.rgb*256.)) shouldDraw=false;}else if(uV){int id=int(aN);inputID=vec4(float(AND(id,255)),float(AND(rightShift(id,8.),255)),float(rightShift(id,16.)),1.);inputID.rgb/=255.;}if(!shouldDraw) return;if(uQ){glPos.xyz/=glPos.w;glPos.w=1.;vec4 zero=getZero();zero.xyz/=zero.w;if(glPos.z>zero.z) return;}aA=(uV)?2.:1.;int index=0;int featureIndex=0;float _size=uY;float size=_size*uW*2.;aE=(uV) ?vec4(inputID.rgb,1.) :(uP) ?aO :uZ;aE.rgb*=aE.a;aB=0.5;if(uR){strokeWidth=ub;if(strokeWidth>0.){aE=ua;aE.rgb*=aE.a;aB=1.-clamp(0.5+(strokeWidth/2.),0.5,0.999);}else{return;}}aC=uP?0.08:max(0.0525,min(0.105,((0.105-0.0525)/(15.-30.))*(_size-15.)+0.105 ) );vec2 XY=(aI+(aJ*size))/uS;vec2 quad=(aK*size)/uS*aG;glPos.xy+=XY+quad;if(!uV) aD=(aL/uT)+(aM/uT*aG);gl_Position=glPos;}",uniforms:{uIsIcon:"uP",uOverdraw:"uQ",uIsStroke:"uR",uAspect:"uS",uTexSize:"uT",uBounds:"uU",uInteractive:"uV",uDevicePixelRatio:"uW",uFeatures:"uX",uSize:"uY",uFill:"uZ",uStroke:"ua",uSWidth:"ub",uFaceST:"uc",uBottom:"ud",uTop:"ue",uMatrix:"uf"},attributes:{aUV:"aG",aST:"aH",aXY:"aI",aOffset:"aJ",aWH:"aK",aTexXY:"aL",aTexWH:"aM",aID:"aN",aColor:"aO",vDraw:"aA",vBuf:"aB",vGamma:"aC",vTexcoord:"aD",vColor:"aE"}},n={source:"precision highp float;varying float aA;varying float aB;varying float aC;varying vec2 aD;varying vec4 aE;uniform sampler2D uF;float median(float r,float g,float b){return max(min(r,g),min(max(r,g),b));}void main(){if(aA==2.){gl_FragColor=aE;}else{vec4 tex=texture2D(uF,aD);if(tex.a<0.01) discard;float opacityS=smoothstep(aB-aC,aB+aC,median(tex.r,tex.g,tex.b));gl_FragColor=opacityS*aE;}}",uniforms:{uGlyphTex:"uF"},attributes:{vDraw:"aA",vBuf:"aB",vGamma:"aC",vTexcoord:"aD",vColor:"aE"}},a={source:"#version 300 es\nprecision highp float;layout(location=0) in vec2 aA;layout(location=1) in vec2 aB;layout(location=2) in vec2 aC;layout(location=3) in vec2 aD;layout(location=4) in vec2 aE;layout(location=5) in vec2 aF;layout(location=6) in vec2 aG;layout(location=7) in float aH;layout(location=8) in vec4 aI;out float aJ;out float aK;out float aL;out vec2 aM;out vec4 aN;uniform bool uO;uniform bool uP;uniform bool uQ;uniform vec2 uR;uniform vec2 uS;uniform vec4 uT;uniform bool uU;uniform float uV;uniform sampler2D uW;uniform float uX[16];uniform float uY[128];uniform float uZ[64];uniform float ua;uniform bool ub;vec4 LCH2LAB(in vec4 lch){float h=lch.b*(3.1415926538/180.);return vec4(lch.r,cos(h)*lch.g,sin(h)*lch.g,lch.a );}float LAB2XYZ(in float t){return t>0.206896552?t*t*t:0.12841855*(t-0.137931034);}float XYZ2RGB(in float r){return 255.*(r<=0.00304?12.92*r:1.055*pow(r,1./2.4)-0.055);}vec4 LAB2RGB(in vec4 lab){float x,y,z,r,g,b;y=(lab.r+16.)/116.;x=y+lab.g/500.;z=y-lab.b/200.;x=0.950470*LAB2XYZ(x);y=1.*LAB2XYZ(y);z=1.088830*LAB2XYZ(z);r=XYZ2RGB(3.2404542*x-1.5371385*y-0.4985314*z);g=XYZ2RGB(-0.9692660*x+1.8760108*y+0.0415560*z);b=XYZ2RGB(0.0556434*x-0.2040259*y+1.0572252*z);if(r<0.) r=0.;else if(r>255.) r=255.;if(g<0.) g=0.;else if(g>255.) g=255.;if(b<0.) b=0.;else if(b>255.) b=255.;return vec4(r,g,b,lab.a);}vec4 LCH2RGB(in vec4 lch){vec4 res;res=LCH2LAB(lch);res=LAB2RGB(res);res.r/=255.;res.g/=255.;res.b/=255.;return res;}vec4 colorBlindAdjust(in vec4 rgba,in float ac){float r=rgba.r*255.;float g=rgba.g*255.;float b=rgba.b*255.;float CVD[9];if(ac==1.) CVD=float[9](0.0,2.02344,-2.52581,0.,1.,0.,0.,0.,1.);else if(ac==2.) CVD=float[9](1.0,0.,0.,0.494207,0.,1.24827,0.,0.,1.);else CVD=float[9](1.0,0.,0.,0.,1.0,0.,-0.395913,0.801109,0.);float L=(17.8824*r)+(43.5161*g)+(4.11935*b);float M=(3.45565*r)+(27.1554*g)+(3.86714*b);float S=(0.0299566*r)+(0.184309*g)+(1.46709*b);float l=(CVD[0]*L)+(CVD[1]*M)+(CVD[2]*S);float m=(CVD[3]*L)+(CVD[4]*M)+(CVD[5]*S);float s=(CVD[6]*L)+(CVD[7]*M)+(CVD[8]*S);float R=(0.0809444479*l)+(-0.130504409*m)+(0.116721066*s);float G=(-0.0102485335*l)+(0.0540193266*m)+(-0.113614708*s);float B=(-0.000365296938*l)+(-0.00412161469*m)+(0.693511405*s);R=r-R;G=g-G;B=b-B;float GG=(0.7*R)+(1.0*G);float BB=(0.7*R)+(1.0*B);return vec4(clamp(r,0.,255.)/255.,clamp(GG+g,0.,255.)/255.,clamp(BB+b,0.,255.)/255.,rgba.a );}float exponentialInterpolation(float inputVal,float start,float end,float base){float diff=end-start;if(diff==0.) return 0.;if(base<=0.) base=0.1;else if(base>2.) base=2.;float progress=inputVal-start;if(base==1.) return progress/diff;return(pow(base,progress)-1.)/(pow(base,diff)-1.);}vec4 interpolateColor(vec4 color1,vec4 color2,float t){if(t==0.) return color1;else if(t==1.) return color2;float sat,hue,lbv,dh,alpha;if(ub){if(color2[0]>color1[0] && color2[0]-color1[0]>180.) dh=color2[0]-color1[0]+360.;else if(color2[0]<color1[0] && color1[0]-color2[0]>180.) dh=color2[0]+360.-color1[0];else dh=color2[0]-color1[0];hue=color1[0]+t*dh;}else{hue=color1[0]+t*(color2[0]-color1[0]);}sat=color1[1]+t*(color2[1]-color1[1]);lbv=color1[2]+t*(color2[2]-color1[2]);alpha=color1[3]+t*(color2[3]-color1[3]);return vec4(hue,sat,lbv,alpha);}vec4 decodeFeature(bool color,inout int index,inout int featureIndex){int decodeOffset=index;int startingOffset=index;int featureSize=int(uY[index])>>10;vec4 res=vec4(-1,-1,-1,-1);int conditionStack[6];float tStack[6];int stackIndex=1;conditionStack[0]=index;int len,conditionSet,condition;do{stackIndex--;startingOffset=index=conditionStack[stackIndex];conditionSet=int(uY[index]);len=conditionSet>>10;condition=(conditionSet & 1008)>>4;index++;if(condition==0){}else if(condition==1){if(res[0]==-1.){for(int i=0;i<len-1;i++) res[i]=uY[index+i];}else{if(color){vec4 val=vec4(uY[index],uY[index+1],uY[index+2],uY[index+3]);res=interpolateColor(res,val,tStack[stackIndex]);}else{for(int i=0;i<len-1;i++) res[i]=res[i]+tStack[stackIndex]*(uY[index+i]-res[i]);}}}else if(condition==2||condition==3){float inputVal,conditionInput;if(condition==2){inputVal=uZ[featureIndex];featureIndex++;}else{inputVal=uX[(conditionSet & 14)>>1];}conditionInput=uY[index];while(inputVal !=conditionInput){index+=(int(uY[index+1])>>10)+1;conditionInput=uY[index];if(conditionInput==0.) break;}index++;conditionStack[stackIndex]=index;tStack[stackIndex]=1.;stackIndex++;}else if(condition==4||condition==5){int interpolationType=conditionSet & 1;int inputType=(conditionSet & 14)>>1;float base=1.;if(interpolationType==1){base=uY[index];index++;}float inputVal,start,end;int startIndex,endIndex,subCondition;if(condition==4){inputVal=uZ[featureIndex];featureIndex++;}else{inputVal=uX[inputType];}start=end=uY[index];startIndex=endIndex=index+1;while(end<inputVal && endIndex<len+startingOffset){subCondition=(int(uY[startIndex]) & 1008)>>4;if(subCondition==2||subCondition==4) featureIndex++;index++;index+=int(uY[index])>>10;start=end;startIndex=endIndex;endIndex=index+1;if(endIndex<len+startingOffset) end=uY[index];}if(startIndex==endIndex){conditionStack[stackIndex]=startIndex;tStack[stackIndex]=1.;if(stackIndex>0) tStack[stackIndex]=tStack[stackIndex-1];stackIndex++;}else if(end==inputVal){conditionStack[stackIndex]=endIndex;tStack[stackIndex]=1.;if(stackIndex>0) tStack[stackIndex]=tStack[stackIndex-1];stackIndex++;}else{float t=exponentialInterpolation(inputVal,start,end,base);conditionStack[stackIndex]=startIndex;tStack[stackIndex]=1.-t;stackIndex++;conditionStack[stackIndex]=endIndex;tStack[stackIndex]=t;stackIndex++;}while(endIndex<len+startingOffset){subCondition=(int(uY[startIndex]) & 1008)>>4;if(subCondition==2||subCondition==4) featureIndex++;index++;index+=int(uY[index])>>10;endIndex=index+1;}}else if(condition==6){res=vec4(0.,0.,0.,1.);return res;}else if(condition==7){}if(stackIndex>5){index=featureSize+decodeOffset;if(color && ub) res=LCH2RGB(res);return res;}}while(stackIndex>0);index=featureSize+decodeOffset;if(color && ub) res=LCH2RGB(res);if(color && ua !=0.) res=colorBlindAdjust(res,ua);return res;}uniform float ud[6];uniform vec4 ue;uniform vec4 uf;uniform mat4 ug;float STtoUV(float s){if(s>=0.5) return(1./3.)*(4.*s*s-1.);else return(1./3.)*(1.-4.*(1.-s)*(1.-s));}vec4 STtoXYZ(in vec2 st){st/=8192.;int face=int(ud[0]);vec3 xyz;vec2 uv=vec2(STtoUV(ud[2]*st.x+ud[3]),STtoUV(ud[4]*st.y+ud[5]) );if(face==0) xyz=vec3(uv.x,uv.y,1.);else if(face==1) xyz=vec3(1.,uv.y,-uv.x);else if(face==2) xyz=vec3(-uv.y,1.,-uv.x);else if(face==3) xyz=vec3(-uv.y,-uv.x,-1.);else if(face==4) xyz=vec3(-1.,-uv.x,uv.y);else xyz=vec3(uv.x,-1.,uv.y);xyz=normalize(xyz)*6371.0088;return vec4(xyz,1.);}vec4 getPosLocal(in vec2 pos){pos/=8192.;vec2 deltaBottom=ue.zw-ue.xy;vec2 deltaTop=uf.zw-uf.xy;vec2 bottomPosS=ue.xy+deltaBottom*pos.x;vec2 topPosS=uf.xy+deltaTop*pos.x;vec2 deltaS=topPosS-bottomPosS;vec2 res=bottomPosS+deltaS*pos.y;return vec4(res,0.,1.);}vec4 getPos(in vec2 pos){if(ud[1]<12.){return ug*STtoXYZ(pos);}else{return getPosLocal(pos);}}vec4 getZero(){if(ud[1]<12.){return ug*vec4(0.,0.,0.,1.);}else{return vec4(0.,0.,1.,1.);}}void main(){if(aB.x<uT.x||aB.x>uT.z||aB.y<uT.y||aB.y>uT.w) return;vec4 glPos=getPos(aB);bool shouldDraw=true;float strokeWidth;vec4 inputID;if(!uP){int id=int(aH);ivec3 colorID=ivec3(float(id & 255),float((id>>8) & 255),float(id>>16));inputID=texture(uW,vec2(glPos/2.+0.5));if(colorID !=ivec3(inputID.rgb*256.)) shouldDraw=false;}else if(uU){int id=int(aH);inputID=vec4(float(id & 255),float((id>>8) & 255),float(id>>16),1.);inputID.rgb/=255.;}if(!shouldDraw) return;if(uP){glPos.xyz/=glPos.w;glPos.w=1.;vec4 zero=getZero();zero.xyz/=zero.w;if(glPos.z>zero.z) return;}aJ=(uU)?2.:1.;int index=0;int featureIndex=0;float _size=decodeFeature(false,index,featureIndex)[0];float size=_size*uV*2.;aN=(uU) ?vec4(inputID.rgb,1.) :(uO) ?aI :decodeFeature(true,index,featureIndex);aN.rgb*=aN.a;aK=0.5;if(uQ){strokeWidth=decodeFeature(false,index,featureIndex)[0];if(strokeWidth>0.){aN=decodeFeature(true,index,featureIndex);aN.rgb*=aN.a;aK=1.-clamp(0.5+(strokeWidth/2.),0.5,0.999);}else{return;}}aL=uO?0.08:max(0.0525,min(0.105,((0.105-0.0525)/(15.-30.))*(_size-15.)+0.105 ) );vec2 XY=(aC+(aD*size))/uR;vec2 quad=(aE*size)/uR*aA;glPos.xy+=XY+quad;if(!uU) aM=(aF/uS)+(aG/uS*aA);gl_Position=glPos;}",uniforms:{uIsIcon:"uO",uOverdraw:"uP",uIsStroke:"uQ",uAspect:"uR",uTexSize:"uS",uBounds:"uT",uInteractive:"uU",uDevicePixelRatio:"uV",uFeatures:"uW",uInputs:"uX",uLayerCode:"uY",uFeatureCode:"uZ",uColorBlind:"ua",uLCH:"ub",uFaceST:"ud",uBottom:"ue",uTop:"uf",uMatrix:"ug"},attributes:{aUV:"aA",aST:"aB",aXY:"aC",aOffset:"aD",aWH:"aE",aTexXY:"aF",aTexWH:"aG",aID:"aH",aColor:"aI",vDraw:"aJ",vBuf:"aK",vGamma:"aL",vTexcoord:"aM",vColor:"aN",colorMode:"ac"}},u={source:"#version 300 es\nprecision highp float;in float aJ;in float aK;in float aL;in vec2 aM;in vec4 aN;uniform sampler2D uh;out vec4 ai;float median(float r,float g,float b){return max(min(r,g),min(max(r,g),b));}void main(){if(aJ==2.){ai=aN;}else{vec4 tex=texture(uh,aM);if(tex.a<0.01) discard;float opacityS=smoothstep(aK-aL,aK+aL,median(tex.r,tex.g,tex.b));ai=opacityS*aN;}}",uniforms:{uGlyphTex:"uh"},attributes:{vDraw:"aJ",vBuf:"aK",vGamma:"aL",vTexcoord:"aM",vColor:"aN",fragColor:"ai"}};function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function f(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(){return c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var r=d(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:i):o.value}},c.apply(this,arguments)}function d(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=x(e)););return e}function v(e,t){return v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},v(e,t)}function h(e,t){if(t&&("object"===l(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return p(e)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function x(e){return x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},x(e)}function b(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");Object.defineProperty(e,"prototype",{value:Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),writable:!1}),t&&v(e,t)}(y,e);var t,i,r,l,d=(r=y,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=x(r);if(l){var i=x(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return h(this,e)});function y(e,t){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,y);var r=e.gl,l=e.type,s=e.devicePixelRatio;return 1===l&&(r.attributeLocations={aUV:0,aST:1,aXY:2,aOffset:3,aWH:4,aTexXY:5,aTexWH:6,aID:7,aColor:8}),b(p(i=d.call(this,e)),"uOverdraw",void 0),b(p(i),"uSize",void 0),b(p(i),"uFill",void 0),b(p(i),"uStroke",void 0),b(p(i),"uSWidth",void 0),b(p(i),"uInteractive",void 0),b(p(i),"uTexSize",void 0),b(p(i),"uIsIcon",void 0),b(p(i),"uBounds",void 0),b(p(i),"uIsStroke",void 0),b(p(i),"uFeatures",void 0),b(p(i),"uGlyphTex",void 0),b(p(i),"glyphType",void 0),b(p(i),"glyphFilterProgram",void 0),b(p(i),"filter",void 0),b(p(i),"fbo",void 0),b(p(i),"defaultBounds",new Float32Array([0,0,8192,8192])),1===l?i.buildShaders(o,n):i.buildShaders(a,u),i.glyphFilterProgram=t,i.use(),r.uniform1i(i.uFeatures,0),r.uniform1i(i.uGlyphTex,1),i.setDevicePixelRatio(s),i.fbo=i._buildFramebuffer(200),r.uniform2fv(i.uTexSize,i.fbo.texSize),i}return t=y,i=[{key:"delete",value:function(){this._deleteFBO(this.fbo),c(x(y.prototype),"delete",this).call(this)}},{key:"_buildFramebuffer",value:function(e){var t=this.gl,i={height:e,texSize:new Float32Array([2048,e]),texture:t.createTexture(),stencil:t.createRenderbuffer(),glyphFramebuffer:t.createFramebuffer()};return t.bindTexture(t.TEXTURE_2D,i.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,2048,e,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindRenderbuffer(t.RENDERBUFFER,i.stencil),t.renderbufferStorage(t.RENDERBUFFER,t.STENCIL_INDEX8,2048,e),t.bindFramebuffer(t.FRAMEBUFFER,i.glyphFramebuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i.texture,0),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,i.stencil),t.bindFramebuffer(t.FRAMEBUFFER,null),i}},{key:"_increaseFBOSize",value:function(e){var t=this.gl,i=this.context,r=this.fbo;if(!(e<=r.height)){this.use();var o=this._buildFramebuffer(e);1===i.type?(t.bindFramebuffer(t.FRAMEBUFFER,r.glyphFramebuffer),t.bindTexture(t.TEXTURE_2D,o.texture),t.copyTexSubImage2D(t.TEXTURE_2D,0,0,0,0,0,2048,r.height)):(t.bindFramebuffer(t.READ_FRAMEBUFFER,r.glyphFramebuffer),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,o.glyphFramebuffer),t.blitFramebuffer(0,0,2048,r.height,0,0,2048,r.height,t.COLOR_BUFFER_BIT,t.LINEAR)),t.bindFramebuffer(t.FRAMEBUFFER,null),t.uniform2fv(this.uTexSize,o.texSize),this._deleteFBO(r),this.fbo=o}}},{key:"_deleteFBO",value:function(e){var t=this.gl;e&&(t.deleteTexture(e.texture),t.deleteRenderbuffer(e.stencil),t.deleteFramebuffer(e.glyphFramebuffer),delete e.width,delete e.height,delete e.texSize,delete e.texture,delete e.stencil,delete e.glyphFramebuffer)}},{key:"setOverdraw",value:function(e){this.filter!==e&&(this.filter=e,this.gl.uniform1i(this.uOverdraw,e))}},{key:"setGlyphType",value:function(e){this.glyphType!==e&&(this.gl.uniform1i(this.uIsIcon,"text"!==e),this.glyphType=e)}},{key:"injectImages",value:function(e,t){var i=this.gl;this._increaseFBOSize(e),i.bindTexture(i.TEXTURE_2D,this.fbo.texture),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);var r,o=function(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return s(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?s(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a=!0,u=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return a=e.done,e},e:function(e){u=!0,n=e},f:function(){try{a||null==i.return||i.return()}finally{if(u)throw n}}}}(t);try{for(o.s();!(r=o.n()).done;){var n=r.value,a=n.posX,u=n.posY,l=n.width,f=n.height,c=n.data;i.texSubImage2D(i.TEXTURE_2D,0,a,u,l,f,i.RGBA,i.UNSIGNED_BYTE,new Uint8ClampedArray(c))}}catch(e){o.e(e)}finally{o.f()}}},{key:"draw",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.gl,o=this.context,n=this.defaultBounds,a=this.fbo,u=this.glyphFilterProgram,l=this.uBounds,s=o.type,f=e.overdraw,c=e.glyphType,d=e.depthPos,v=e.featureCode,h=e.offset,p=e.count,x=e.size,b=e.fill,y=e.stroke,g=e.strokeWidth,m=e.bounds,S=t.glyphQuadBuffer,I=t.glyphColorBuffer,T=a.texture;1===s?(isNaN(x)||r.uniform1f(this.uSize,x),b&&b.length&&r.uniform4fv(this.uFill,b),y&&y.length&&r.uniform4fv(this.uStroke,y),isNaN(g)||r.uniform1f(this.uSWidth,g)):this.setFeatureCode(v),m?r.uniform4fv(l,m):r.uniform4fv(l,n),o.stencilFuncAlways(0),o.enableDepthTest(),i?o.lessDepth():o.lequalDepth(),o.setDepthRange(d),o.defaultBlend(),this.setOverdraw(f),this.setGlyphType(c),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,T),r.activeTexture(r.TEXTURE0),u.bindResultTexture(),r.bindBuffer(r.ARRAY_BUFFER,S),r.vertexAttribPointer(1,2,r.FLOAT,!1,52,52*h),r.vertexAttribPointer(2,2,r.FLOAT,!1,52,8+52*h),r.vertexAttribPointer(3,2,r.FLOAT,!1,52,16+52*h),r.vertexAttribPointer(4,2,r.FLOAT,!1,52,24+52*h),r.vertexAttribPointer(5,2,r.FLOAT,!1,52,32+52*h),r.vertexAttribPointer(6,2,r.FLOAT,!1,52,40+52*h),r.vertexAttribPointer(7,1,r.FLOAT,!1,52,48+52*h),r.bindBuffer(r.ARRAY_BUFFER,I),r.vertexAttribPointer(8,4,r.UNSIGNED_BYTE,!0,4,4*h),"text"===c&&(r.uniform1i(this.uIsStroke,!0),r.drawArraysInstanced(r.TRIANGLE_FAN,0,4,p),r.uniform1i(this.uIsStroke,!1)),r.drawArraysInstanced(r.TRIANGLE_FAN,0,4,p)}}],i&&f(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),y}(r.Z)},53:(e,t,i)=>{function r(e,t,i){var r=e.createShader(i);if(e.shaderSource(r,t),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)){var o=e.getShaderInfoLog(r);return console.log("*** Error compiling shader '".concat(r,"': ").concat(o)),e.deleteShader(r),null}return r}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function n(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function a(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?n(Object(i),!0).forEach((function(t){l(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function u(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}i.d(t,{Z:()=>s});var s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),l(this,"vertexShader",void 0),l(this,"fragmentShader",void 0),l(this,"radii",!1),l(this,"context",void 0),l(this,"gl",void 0),l(this,"glProgram",void 0),l(this,"uMatrix",void 0),l(this,"uAspect",void 0),l(this,"uMode",void 0),l(this,"u3D",void 0),l(this,"uLCH",void 0),l(this,"uInteractive",void 0),l(this,"uFaceST",void 0),l(this,"uBottom",void 0),l(this,"uTop",void 0),l(this,"uInputs",void 0),l(this,"uLayerCode",void 0),l(this,"uFeatureCode",void 0),l(this,"uDevicePixelRatio",void 0),l(this,"updateColorBlindMode","none"),l(this,"updateMatrix",null),l(this,"updateInputs",null),l(this,"updateAspect",null),l(this,"curMode",-1),l(this,"threeD",void 0),l(this,"LCH",void 0),l(this,"colorBlind",void 0),l(this,"interactive",void 0),this.context=t;var i=t.gl;this.gl=i,this.glProgram=i.createProgram()}var t,i;return t=e,i=[{key:"buildShaders",value:function(e,t){var i=this.gl,o=this.glProgram;this.setupAttributes(e.attributes);var n=this.vertexShader=r(i,e.source,i.VERTEX_SHADER),u=this.fragmentShader=r(i,t.source,i.FRAGMENT_SHADER);if(!n||!u)throw Error("missing shaders");if(i.attachShader(o,n),i.attachShader(o,u),i.linkProgram(o),!i.getProgramParameter(o,i.LINK_STATUS))throw Error(i.getProgramInfoLog(o));this.setupUniforms(a(a({},e.uniforms),t.uniforms))}},{key:"setupUniforms",value:function(e){for(var t=this.gl,i=this.glProgram,r=0,n=Object.entries(e);r<n.length;r++){var a=(s=n[r],f=2,function(e){if(Array.isArray(e))return e}(s)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var r,o,n=[],a=!0,u=!1;try{for(i=i.call(e);!(a=(r=i.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==i.return||i.return()}finally{if(u)throw o}}return n}}(s,f)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?o(e,t):void 0}}(s,f)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=a[0],l=a[1];this[u]=t.getUniformLocation(i,l)}var s,f}},{key:"setupAttributes",value:function(e){var t=this.gl,i=this.glProgram,r=t.attributeLocations;if(r)for(var o in r)t.bindAttribLocation(i,r[o],e[o])}},{key:"delete",value:function(){var e=this.gl,t=this.vertexShader,i=this.fragmentShader;e.deleteShader(t),e.deleteShader(i)}},{key:"use",value:function(){var e=this.gl,t=this.glProgram;e.useProgram(t),this.flush()}},{key:"injectFrameUniforms",value:function(e,t,i){this.updateMatrix=e,this.updateInputs=t,this.updateAspect=i}},{key:"flush",value:function(){this.updateColorBlindMode&&this.setColorBlindMode(this.updateColorBlindMode),this.updateMatrix&&this.setMatrix(this.updateMatrix),this.updateInputs&&this.setInputs(this.updateInputs),this.updateAspect&&this.setAspect(this.updateAspect)}},{key:"setDevicePixelRatio",value:function(e){this.gl.uniform1f(this.uDevicePixelRatio,e)}},{key:"setColorBlindMode",value:function(e){this.gl.uniform1f(this.uColorBlind,"protanopia"===e?1:"deutranopia"===e?2:"tritanopia"===e?3:0),this.updateColorBlindMode=null}},{key:"setMatrix",value:function(e){this.gl.uniformMatrix4fv(this.uMatrix,!1,e),this.updateMatrix=null}},{key:"setInputs",value:function(e){this.gl.uniform1fv(this.uInputs,e,0,e.length),this.updateInputs=null}},{key:"setAspect",value:function(e){this.uAspect&&this.gl.uniform2fv(this.uAspect,e),this.updateAspect=null}},{key:"setFaceST",value:function(e){this.gl.uniform1fv(this.uFaceST,e,0,e.length)}},{key:"setTilePos",value:function(e,t){e&&this.gl.uniform4fv(this.uBottom,e,0,4),t&&this.gl.uniform4fv(this.uTop,t,0,4)}},{key:"setLayerCode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.gl;e.length&&i.uniform1fv(this.uLayerCode,e,0,e.length),this.uLCH&&this.LCH!==t&&(this.LCH=t,i.uniform1i(this.uLCH,~~t))}},{key:"setInteractive",value:function(e){var t=this.gl;this.interactive!==e&&(this.interactive=e,t.uniform1i(this.uInteractive,e))}},{key:"setFeatureCode",value:function(e){e&&e.length&&this.gl.uniform1fv(this.uFeatureCode,e)}},{key:"set3D",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.u3D&&this.threeD!==e&&(this.threeD=e,this.gl.uniform1i(this.u3D,e))}},{key:"setMode",value:function(e){this.uMode&&this.curMode!==e&&(this.curMode=e,this.gl.uniform1i(this.uMode,e))}},{key:"draw",value:function(e){}}],i&&u(t.prototype,i),Object.defineProperty(t,"prototype",{writable:!1}),e}()}}]);