(()=>{"use strict";var t,e,r={992:(t,e,r)=>{var n=r(840),o=r.n(n);function i(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||s(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=s(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}function u(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i=[],a=!0,u=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}}(t,e)||s(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){if(t){if("string"==typeof t)return l(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(t,e):void 0}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function c(t,e,r,n,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,o)}function f(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){c(i,n,o,a,u,"next",t)}function u(t){c(i,n,o,a,u,"throw",t)}a(void 0)}))}}function h(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function p(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var y=function(t){return t>>1^-(1&t)},v=function(t){return t.toString(36)},d=function(){return Math.random().toString(16).replace("0.","")},m=function(){function t(e,r,n,o,i,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),p(this,"ready",!1),p(this,"version",void 0),p(this,"extent",void 0),p(this,"name",void 0),p(this,"size",void 0),p(this,"fallback",void 0),p(this,"defaultAdvance",void 0),p(this,"maxHeight",void 0),p(this,"range",void 0),p(this,"texturePack",void 0),p(this,"needsToken",!1),p(this,"session",void 0),p(this,"colors",void 0),p(this,"iconMap",void 0),p(this,"glyphMap",new Map),p(this,"glyphWaitlist",new Map),p(this,"glyphCache",new Map),p(this,"requestCache",[]),this.name=e,this.path=r,this.fallback=n,this.texturePack=o,i&&(this.needsToken=!0),this.session=a}var e,r,n,s,l;return e=t,r=[{key:"build",value:(l=f(o().mark((function t(e){var r,n;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this,t.next=3,this._fetch("".concat(this.path,"?bytes=0-u"),e);case 3:if(n=t.sent){t.next=9;break}r.active=!1,console.log("FAILED TO extrapolate ".concat(this.path," metadata")),t.next=11;break;case 9:return t.next=11,r._buildMetadata(n,e);case 11:case"end":return t.stop()}}),t,this)}))),function(t){return l.apply(this,arguments)})},{key:"_buildMetadata",value:(s=f(o().mark((function t(e,r){var n,i,a,u,s,l,c,f,h,p,y;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.glyphMap,i=new DataView(e),this.version=i.getUint16(2,!0),this.extent=i.getUint16(4,!0),this.size=i.getUint16(6,!0),this.maxHeight=i.getUint16(8,!0),this.range=i.getUint16(10,!0),this.defaultAdvance=i.getUint16(12,!0)/this.extent,a=i.getUint32(14,!0),u=i.getUint32(22,!0),s=i.getUint32(26,!0),t.next=13,this._fetch("".concat(this.path,"?bytes=u-").concat(v(a)),r);case 13:for(l=t.sent,c=l.byteLength-u-s,f=c/8,h=new DataView(l,0,c),p=0;p<f;p++)y=8*p,n.set(h.getUint16(y,!0),{pos:h.getUint32(y+2,!0),length:h.getUint16(y+6,!0)});u&&(this._buildIconMap(u,new DataView(l,c,u)),this._buildColorMap(s,new DataView(l,c+u,s))),this.ready=!0,this._checkCache();case 21:case"end":return t.stop()}}),t,this)}))),function(t,e){return s.apply(this,arguments)})},{key:"_buildIconMap",value:function(t,e){this.iconMap={};for(var r=0;r<t;){var n=e.getUint8(r),o=e.getUint8(r+1);r+=2;for(var i=[],a=0;a<n;a++)i.push(e.getUint8(r+a));i=i.map((function(t){return String.fromCharCode(t)})).join(""),r+=n;for(var u=[],s=0;s<o;s++)u.push({glyphID:e.getUint16(r,!0),colorID:e.getUint16(r+2,!0)}),r+=4;this.iconMap[i]=u}}},{key:"_buildColorMap",value:function(t,e){this.colors=[];for(var r=0;r<t;r+=4)this.colors.push([e.getUint8(r),e.getUint8(r+1),e.getUint8(r+2),e.getUint8(r+3)])}},{key:"_checkCache",value:function(){for(;this.requestCache.length;){var t=u(this.requestCache.pop(),5),e=t[0],r=t[1],n=t[2],o=t[3],i=t[4];"icon"===e?this.iconRequest(r,n,o,i):this.glyphRequest(r,n,o,i)}}},{key:"iconRequest",value:function(t,e,r,n){if(this.ready){var o,u=this.iconMap,s=this.colors,l={},c={},f=new Set,h=a(t);try{for(h.s();!(o=h.n()).done;){var p=o.value,y=u[p];if(y){l[p]=y;var v,d=a(y);try{for(d.s();!(v=d.n()).done;){var m=v.value,b=m.glyphID,g=m.colorID;f.add(b),c[g]=s[g]}}catch(t){d.e(t)}finally{d.f()}}else l[p]=[]}}catch(t){h.e(t)}finally{h.f()}this.glyphRequest(i(f),e,r,n,l,c)}else this.requestCache.push(["icon",t,e,r,n])}},{key:"glyphRequest",value:function(t,e,r,n,o,s){if(this.ready){var l,c=this,f=c.glyphCache,h=c.glyphMap,p=c.fallback,y=c.glyphWaitlist,v=c.defaultAdvance,m=c.name,b=[],g=[],w=[],x=new Map,k=a(t);try{for(k.s();!(l=k.n()).done;){var S=l.value;if(!f.has(S))if(y.has(S)){var j=y.get(S);x.set(j.id,j)}else h.has(S)?g.push(S):p&&p.glyphMap.has(S)?w.push(S):f.set(S,{texX:0,texY:0,texW:0,texH:0,xOffset:0,yOffset:0,width:0,height:0,advanceWidth:v})}}catch(t){k.e(t)}finally{k.f()}if(g.length){var O=c._requestGlyphs(g,e);O.id=d(),b.push(O);var P,M=a(g);try{for(M.s();!(P=M.n()).done;){var A=P.value;y.set(A,O)}}catch(t){M.e(t)}finally{M.f()}}if(w.length){var I=p._requestGlyphs(w,e);I.id=d(),b.push(I);var _,T=a(w);try{for(T.s();!(_=T.n()).done;){var q=_.value;y.set(q,I)}}catch(t){T.e(t)}finally{T.f()}}b.push.apply(b,i(Array.from(x,(function(t){return u(t,2)[1]})))),Promise.all(b).then((function(){var i,u=[],l=a(t);try{for(l.s();!(i=l.n()).done;){var c=i.value,h=f.has(c)?f.get(c):p.glyphCache.has(c)?p.glyphCache.get(c):null;if(h){var y=h.texX,v=h.texY,d=h.texW,b=h.texH,g=h.xOffset,w=h.yOffset,x=h.width,k=h.height,S=h.advanceWidth;u.push(c,y,v,d,b,g,w,x,k,S)}}}catch(t){l.e(t)}finally{l.f()}var j=new Float32Array(u).buffer;n.postMessage({mapID:e,type:"glyphresponse",reqID:r,glyphMetadata:j,familyName:m,icons:o,colors:s},[j])}))}else this.requestCache.push(["glyph",t,e,r,n])}},{key:"_requestGlyphs",value:function(t,e){var r,n=this.extent,o=this.glyphCache,i=this.glyphWaitlist,s=this.maxHeight,l=this.texturePack,c=[],f=a(this.buildRequests(t));try{for(f.s();!(r=f.n()).done;){var h=r.value;c.push(this._fetch(h,e).then((function(t){for(var r=[],a=new DataView(t),c=a.byteLength-1,f=0;f<c;){var h=a.getUint16(f,!0),p={unicode:h,width:a.getUint16(f+2,!0)/n,height:a.getUint16(f+4,!0)/n,texW:a.getUint8(f+6),texH:a.getUint8(f+7),xOffset:y(a.getUint16(f+8,!0))/n,yOffset:y(a.getUint16(f+10,!0))/n,advanceWidth:y(a.getUint16(f+12,!0))/n};f+=14;var v=u(l.addGlyph(p.texW,s),2),d=v[0],m=v[1];p.texX=d,p.texY=m,o.set(h,p),i.delete(h);var b=p.texW*p.texH*4,g=new Uint8ClampedArray(t.slice(f,f+b)).buffer;r.push({posX:d,posY:m,width:p.texW,height:p.texH,data:g}),f+=b}var w=r.reduce((function(t,e){return Math.max(t,e.posY+e.height)}),0);postMessage({mapID:e,type:"glyphimages",images:r,maxHeight:w},r.map((function(t){return t.data})))})))}}catch(t){f.e(t)}finally{f.f()}return Promise.all(c)}},{key:"buildRequests",value:function(t){var e=this.path,r=this.glyphMap,n=[],o=[];t.sort((function(t,e){return t-e}));for(var i=0;i<t.length;i+=35)o.push(t.slice(i,i+35));for(var s=0,l=o;s<l.length;s++){var c,f=[],h=a(l[s]);try{for(h.s();!(c=h.n()).done;){var p=c.value,y=r.get(p),d=y.pos,m=y.length;f.push([d,m])}}catch(t){h.e(t)}finally{h.f()}f=(f=b(f)).map((function(t){var e=u(t,2),r=e[0],n=e[1];return"".concat(v(r),"-").concat(v(n))})),n.push("".concat(e,"?bytes=").concat(f.join(",")))}return n}},{key:"_fetch",value:(n=f(o().mark((function t(e,r){var n,i,a;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n={},t.t0=this.needsToken,!t.t0){t.next=6;break}return t.next=5,this.session.requestSessionToken(r);case 5:t.t0=t.sent;case 6:return(i=t.t0)&&(n.Authorization=i),t.next=10,fetch(e,{headers:n});case 10:if(200===(a=t.sent).status||206===a.status){t.next=13;break}return t.abrupt("return",null);case 13:return t.abrupt("return",a.arrayBuffer());case 14:case"end":return t.stop()}}),t,this)}))),function(t,e){return n.apply(this,arguments)})}],r&&h(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function b(t){return t.reduce((function(t,e){if(0===t.length)return[e];var r=t[t.length-1];return e[0]===r[0]+r[1]?(r[1]+=e[1],t):(t.push(e),t)}),[])}function g(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var w=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"build",value:function(){}},{key:"tileRequest",value:function(t,e){var r=e.id,n=e.face,o=e.zoom,i=e.i,a=e.j;return{layers:{boundary:{extent:8192,length:1,feature:function(){return{properties:{id:r,face:n,zoom:o,i,j:a},type:3,loadGeometry:function(){return[[[0,0],[8192,0],[8192,8192],[0,8192],[0,0]]]}}}},name:{extent:8192,length:1,feature:function(){return{properties:{id:r,face:n,zoom:o,i,j:a},type:1,loadGeometry:function(){return[[4096,4096]]}}}}}}}}],r&&g(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function x(t){return t*Math.PI/180}function k(t,e){if(t){if("string"==typeof t)return S(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?S(t,e):void 0}}function S(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function j(t){return t>=0?.5*Math.sqrt(1+3*t):1-.5*Math.sqrt(1-3*t)}function O(t){var e,r=function(t){var e=t.map((function(t){return Math.abs(t)})),r=e[0]>e[1]?e[0]>e[2]?0:2:e[1]>e[2]?1:2;return t[r]<0&&(r+=3),r}(t);return[r].concat((e=function(t,e){var r=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i=[],a=!0,u=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}}(t,e)||k(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,3),n=r[0],o=r[1],i=r[2];switch(t){case 0:return[o/n,i/n];case 1:return[-n/o,i/o];case 2:return[-n/i,-o/i];case 3:return[i/n,o/n];case 4:return[i/o,-n/o];default:return[-o/i,-n/i]}}(r,t),function(t){if(Array.isArray(t))return S(t)}(e)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||k(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()))}function P(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i=[],a=!0,u=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return M(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?M(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}for(var A=[],I=[],_=0;_<4;_++)T(0,0,0,_,0,_);function T(t,e,r,n,o,i){var a=[1,0,0,3];if(4===t){var u=(e<<4)+r;A[(u<<2)+n]=BigInt((o<<2)+i),I[(o<<2)+n]=BigInt((u<<2)+i)}else{t++,r<<=1,o<<=2;var s=[[0,1,3,2],[0,2,3,1],[3,2,0,1],[3,1,0,2]][i];T(t,(e<<=1)+(s[0]>>1),r+(1&s[0]),n,o,i^a[0]),T(t,e+(s[1]>>1),r+(1&s[1]),n,o+1,i^a[1]),T(t,e+(s[2]>>1),r+(1&s[2]),n,o+2,i^a[2]),T(t,e+(s[3]>>1),r+(1&s[3]),n,o+3,i^a[3])}}function q(t){return(BigInt(t)<<61n)+(1n<<60n)}function C(t,e,r,n){var o=BigInt(t),i=BigInt(e),a=BigInt(r);if(void 0!==n){var u=BigInt(n);i<<=30n-u,a<<=30n-u}for(var s=o<<60n,l=1n&o,c=7n;c>=0n;c--){var f=4n*c;l+=(i>>f&15n)<<6n,s|=(l=A[l+=(a>>f&15n)<<2n])>>2n<<8n*c,l&=3n}var h=2n*s+1n;return void 0!==n?L(h,n):h}function D(t,e){for(var r=0n,n=0n,o=t>>61n,i=1n&o,a=7n;a>=0n;a--)r+=(i=I[i+=(t>>8n*a+1n&(1n<<2n*(7n===a?2n:4n))-1n)<<2n])>>6n<<4n*a,n+=(i>>2n&15n)<<4n*a,i&=3n;return 1229782938247303424n&t&~t+1n&&(i^=1n),void 0!==e&&(r>>=30n-(e=BigInt(e)),n>>=30n-e),[Number(o),Number(r),Number(n),Number(i)]}function E(t){return Number(t>>61n)}function U(t){return!(t&(1n<<60n)-1n)}function z(t){for(var e=0,r=0n;!(t&1n<<r)&&r<60n;)r+=2n,e++;return 30-e}function R(t,e,r,n){return[C(t,r<<=1,n<<=1,e+1),C(t,r+1,n,e+1),C(t,r,n+1,e+1),C(t,r+1,n+1,e+1)]}function L(t,e){var r=void 0!==e?1n<<2n*(30n-BigInt(e)):(t&~t+1n)<<2n;return t&~r+1n|r}function W(t){var e=t&~t+1n;return[t-(e-1n),t+(e-1n)]}function N(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function F(t,e){return function(t,e){return t=x(t),e=x(e),[Math.cos(e)*Math.cos(t),Math.cos(e)*Math.sin(t),Math.sin(e)]}(t,e)}function B(t){var e=function(t){return O(t)}(t),r=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i=[],a=!0,u=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return N(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?N(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,3),n=r[0],o=r[1],i=r[2];return[n,j(o),j(i)]}function G(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i=[],a=!0,u=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}}(t,e)||K(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=K(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}function K(t,e){if(t){if("string"==typeof t)return Z(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Z(t,e):void 0}}function Z(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function H(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function V(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Y=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),V(this,"name",void 0),V(this,"idGen",0),V(this,0,new Map),V(this,1,new Map),V(this,2,new Map),V(this,3,new Map),V(this,4,new Map),V(this,5,new Map),V(this,"session",void 0),this.name=e,this.session=r}var e,r;return e=t,r=[{key:"addMarkers",value:function(t){var e,r=$(t);try{for(r.s();!(e=r.n()).done;){var n=e.value,o=n.id,i=n.properties,a=n.lon,u=n.lat;if(i||(i={}),!isNaN(a)&&!isNaN(u)){var s=G(B(F(a,u)),3),l=s[0],c=s[1],f=s[2];if(!o){for(;this[l].has(this.idGen);)this.idGen++;o=this.idGen}i._markerID=o,this[l].set(o,{properties:i,geometry:[c,f]})}}}catch(t){r.e(t)}finally{r.f()}}},{key:"removeMarkers",value:function(t){var e,r=$(t);try{for(r.s();!(e=r.n()).done;){var n=e.value;this[0].has(n)?this[0].delete(n):this[1].has(n)?this[1].delete(n):this[2].has(n)?this[2].delete(n):this[3].has(n)?this[3].delete(n):this[4].has(n)?this[4].delete(n):this[5].has(n)&&this[5].delete(n)}}catch(t){r.e(t)}finally{r.f()}}},{key:"tileRequest",value:function(t,e){var r,n=e.id,o=e.face,i=e.zoom,a=e.bbox,u=e.i,s=e.j,l=1<<i,c=[],f=G(a,4),h=f[0],p=f[1],y=f[2],v=f[3],d=$(this[o]);try{for(d.s();!(r=d.n()).done;){var m=G(r.value,2)[1],b=m.properties,g=G(m.geometry,2),w=g[0],x=g[1];w>=h&&w<y&&x>=p&&x<v&&c.push({type:1,properties:b,geometry:[J(w,x,8192,l,u,s)]})}}catch(t){d.e(t)}finally{d.f()}if(c.length){var k={extent:8192,face:o,zoom:i,i:u,j:s,layers:{default:{extent:8192,features:c,length:c.length}}};k=new TextEncoder("utf-8").encode(JSON.stringify(k)).buffer,this.session.requestWorker().postMessage({mapID:t,type:"jsondata",tile:e,sourceName:"_markers",data:k},[k])}else postMessage({mapID:t,tileID:n,source:"_markers",type:"flush",fill:!1,line:!1,point:!1,heatmap:!1,glyph:!1})}}],r&&H(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function J(t,e,r,n,o,i){var a=Math.round;return[a(r*(t*n-o)),a(r*(e*n-i))]}function X(t,e,r,n){for(var o,i=n,a=r-e>>1,u=r-e,s=t[e],l=t[e+1],c=t[r],f=t[r+1],h=e+3;h<r;h+=3){var p=Q(t[h],t[h+1],s,l,c,f);if(p>i)o=h,i=p;else if(p===i){var y=Math.abs(h-a);y<u&&(o=h,u=y)}}o&&i>n&&(o-e>3&&X(t,e,o,n),t[o+2]=i,r-o>3&&X(t,o,r,n))}function Q(t,e,r,n,o,i){var a=o-r,u=i-n;if(0!==a||0!==u){var s=((t-r)*a+(e-n)*u)/(a*a+u*u);s>1?(r=o,n=i):s>0&&(r+=a*s,n+=u*s)}return(a=t-r)*a+(u=e-n)*u}function tt(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return et(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?et(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}function et(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function rt(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=arguments.length>4?arguments[4]:void 0,i={id:t,type:e,geometry:r,properties:n,face:o,minS:1/0,minT:1/0,maxS:-1/0,maxT:-1/0};return nt(i),i}function nt(t){var e=t.geometry,r=t.type;if("Point"===r||"MultiPoint"===r||"LineString"===r)ot(t,e);else if("Polygon"===r||"MultiLineString"===r){var n,o=tt(e);try{for(o.s();!(n=o.n()).done;)ot(t,n.value)}catch(t){o.e(t)}finally{o.f()}}else if("MultiPolygon"===r){var i,a=tt(e);try{for(a.s();!(i=a.n()).done;){var u,s=tt(i.value);try{for(s.s();!(u=s.n()).done;)ot(t,u.value)}catch(t){s.e(t)}finally{s.f()}}}catch(t){a.e(t)}finally{a.f()}}}function ot(t,e){for(var r=0;r<e.length;r+=3)t.minS=Math.min(t.minS,e[r]),t.minT=Math.min(t.minT,e[r+1]),t.maxS=Math.max(t.maxS,e[r]),t.maxT=Math.max(t.maxT,e[r+1])}function it(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return at(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?at(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}function at(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function ut(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(e.geometry){var o=e.geometry.coordinates,i=e.geometry.type,a=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),u=[],s=e.id||0;if(r.promoteId?s=e.properties[r.promoteId]:r.generateId&&(s=n),"Point"===i)st(o,u);else if("MultiPoint"===i){var l,c=it(o);try{for(c.s();!(l=c.n()).done;){var f=l.value;st(f,u)}}catch(t){c.e(t)}finally{c.f()}}else if("LineString"===i)lt(o,u,a,!1);else if("MultiLineString"===i)ct(o,u,a,!1);else if("Polygon"===i)ct(o,u,a,!0);else{if("MultiPolygon"!==i)throw new Error("Input data is not a valid GeoJSON object.");var h,p=it(o);try{for(p.s();!(h=p.n()).done;){var y=h.value,v=[];ct(y,v,a,!0),u.push(v)}}catch(t){p.e(t)}finally{p.f()}}t.push(rt(s,i,u,e.properties,e.face))}}function st(t,e){e.push(t[0],t[1],0)}function lt(t,e,r,n){var o,i,a,u,s=0;o=a=t[0][0],i=u=t[0][1],e.push(o,i,0);for(var l=1;l<t.length;l++)o=t[l][0],i=t[l][1],e.push(o,i,0),s+=n?(a*i-o*a)/2:Math.sqrt(Math.pow(o-a,2)+Math.pow(i-u,2)),a=o,u=i;var c=e.length-3;e[2]=1,X(e,0,c,r),e[c+2]=1,e.size=Math.abs(s),e.start=0,e.end=e.size}function ct(t,e,r,n){for(var o=0;o<t.length;o++){var i=[];lt(t[o],i,r,n),e.push(i)}}function ft(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=pt(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}function ht(t){return function(t){if(Array.isArray(t))return yt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||pt(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pt(t,e){if(t){if("string"==typeof t)return yt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?yt(t,e):void 0}}function yt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function vt(t,e,r){var n,o,i,a,u=[[],[],[],[]],s=e.i,l=e.j,c=e.zoom,f=e.minS,h=e.minT,p=e.maxS,y=e.maxT,v=1<<c,d=.5/r.extent,m=.5-d,b=.5+d,g=1+d,w=null,x=null,k=null,S=null,j=dt(t,v,s-d,s+b,0,f,p,r),O=dt(t,v,s+m,s+g,0,f,p,r);return t=null,j&&(x=dt(j,v,l-d,l+b,1,h,y,r),w=dt(j,v,l+m,l+g,1,h,y,r),x&&(n=u[0]).push.apply(n,ht(x)),w&&(o=u[2]).push.apply(o,ht(w)),j=null),O&&(S=dt(O,v,l-d,l+b,1,h,y,r),k=dt(O,v,l+m,l+g,1,h,y,r),S&&(i=u[1]).push.apply(i,ht(S)),k&&(a=u[3]).push.apply(a,ht(k)),O=null),u}function dt(t,e,r,n,o,i,a,u){var s=((n/=e)-(r/=e))/u.extent*u.buffer;if(i>=r&&a<n)return t;if(a<r||i>=n)return null;var l,c=[],f=ft(t);try{for(f.s();!(l=f.n()).done;){var h=l.value,p=h.geometry,y=h.type,v=0===o?h.minS:h.minT,d=0===o?h.maxS:h.maxT;if(v>=r&&d<n)c.push(h);else if(!(d<r||v>=n)){var m=[];if("Point"===y||"MultiPoint"===y)mt(p,m,r,n,o);else if("LineString"===y)bt(p,m,r-s,n+s,o,!1);else if("MultiLineString"===y)wt(p,m,r-s,n+s,o,!1);else if("Polygon"===y)wt(p,m,r-s,n+s,o,!0);else if("MultiPolygon"===y){var b,g=ft(p);try{for(g.s();!(b=g.n()).done;){var w=b.value,x=[];wt(w,x,r-s,n+s,o,!0),x.length&&m.push(x)}}catch(t){g.e(t)}finally{g.f()}}m.length&&("LineString"!==y&&"MultiLineString"!==y||(1===m.length?(y="LineString",m=m[0]):y="MultiLineString"),"Point"!==y&&"MultiPoint"!==y||(y=3===m.length?"Point":"MultiPoint"),c.push(rt(h.id,y,m,h.properties)))}}}catch(t){f.e(t)}finally{f.f()}return c.length?c:null}function mt(t,e,r,n,o){for(var i=0;i<t.length;i+=3){var a=t[i+o];a>=r&&a<n&&xt(e,t[i],t[i+1],t[i+2])}}function bt(t,e,r,n,o,i){for(var a=gt(t),u=0===o?kt:St,s=0;s<t.length-3;s+=3){var l=t[s],c=t[s+1],f=t[s+2],h=t[s+3],p=t[s+4],y=0===o?l:c,v=0===o?h:p,d=!1;y<r?v>r&&u(a,l,c,h,p,r):y>n?v<n&&u(a,l,c,h,p,n):xt(a,l,c,f),v<r&&y>=r&&(u(a,l,c,h,p,r),d=!0),v>n&&y<=n&&(u(a,l,c,h,p,n),d=!0),!i&&d&&(e.push(a),a=gt(t))}var m=t.length-3,b=t[m],g=t[m+1],w=t[m+2],x=0===o?b:g;x>=r&&x<=n&&xt(a,b,g,w),m=a.length-3,i&&m>=3&&(a[m]!==a[0]||a[m+1]!==a[1])&&xt(a,a[0],a[1],a[2]),a.length&&e.push(a)}function gt(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function wt(t,e,r,n,o,i){var a,u=ft(t);try{for(u.s();!(a=u.n()).done;)bt(a.value,e,r,n,o,i)}catch(t){u.e(t)}finally{u.f()}}function xt(t,e,r,n){t.push(e,r,n)}function kt(t,e,r,n,o,i){var a=(i-e)/(n-e);return xt(t,i,r+(o-r)*a,1),a}function St(t,e,r,n,o,i){var a=(i-r)/(o-r);return xt(t,e+(n-e)*a,i,1),a}function jt(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return Ot(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ot(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}function Ot(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Pt(t,e){if(!t.transformed){var r=1<<t.zoom,n=t.i,o=t.j;for(var i in t.layers){var a,u=jt(t.layers[i].features);try{for(u.s();!(a=u.n()).done;){var s=a.value,l=s.geometry,c=s.type,f=[];if(1===c)for(var h=0;h<l.length;h+=2)f.push(Mt(l[h],l[h+1],e,r,n,o));else if(4===c)for(var p=0,y=l.length;p<y;p++){for(var v=l[p],d=[],m=0,b=v.length;m<b;m++){for(var g=[],w=0;w<v[m].length;w+=2)g.push(Mt(v[m][w],v[m][w+1],e,r,n,o));(0===m||m>0&&g.length>=4)&&d.push(g)}d[0].length>=4&&f.push(d)}else{for(var x=0,k=l.length;x<k;x++){for(var S=[],j=0,O=l[x].length;j<O;j+=2)S.push(Mt(l[x][j],l[x][j+1],e,r,n,o));f.push(S)}3===c&&f[0].length<4&&(f=[])}s.geometry=f}}catch(t){u.e(t)}finally{u.f()}}t.transformed=!0}return{zoom:t.zoom,i:t.i,j:t.j,layers:t.layers,extent:e}}function Mt(t,e,r,n,o,i){return[Math.round(r*(t*n-o)),Math.round(r*(e*n-i))]}function At(t,e){if(t){if("string"==typeof t)return It(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?It(t,e):void 0}}function It(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function _t(t,e,r){var n,o=z(e),i=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i=[],a=!0,u=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}}(t,e)||At(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(D(e,o),4),a=i[1],u=i[2],s=i[3],l=o===r.maxZoom?0:r.tolerance/((1<<o)*r.extent),c={extent:r.extent,layers:{},numPoints:0,numSimplified:0,numFeatures:0,source:t,id:e,zoom:o,i:a,j:u,ori:s,transformed:!1,minS:2,minT:2,maxS:-2,maxT:-2},f=Math.min,h=Math.max,p=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=At(t))){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}(t);try{for(p.s();!(n=p.n()).done;){var y=n.value;c.numFeatures++,Tt(c,y,l),c.minS=f(c.minS,y.minS),c.minT=f(c.minT,y.minT),c.maxS=h(c.maxS,y.maxS),c.maxT=h(c.maxT,y.maxT)}}catch(t){p.e(t)}finally{p.f()}return c}function Tt(t,e,r){var n=e.geometry,o=e.type,i=[];if("Point"===o||"MultiPoint"===o)for(var a=0;a<n.length;a+=3)i.push(n[a]),i.push(n[a+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)qt(i,n,t,r,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(var u=0;u<n.length;u++)qt(i,n[u],t,r,"Polygon"===o,0===u);else if("MultiPolygon"===o)for(var s=0;s<n.length;s++){for(var l=n[s],c=[],f=0;f<l.length;f++)qt(c,l[f],t,r,!0,0===f);i.push(c)}if(i.length){var h={id:e.id?e.id:null,geometry:i,type:"MultiPolygon"===o?4:"Polygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,properties:e.properties},p=e.properties._layer||"default";t.layers[p]||(t.layers[p]={extent:t.extent,features:[],length:0});var y=t.layers[p];y.features.push(h),y.length++}}function qt(t,e,r,n,o,i){var a=n*n;if(n>0&&e.size<(o?a:n))r.numPoints+=e.length/3;else{for(var u=[],s=0;s<e.length;s+=3)(0===n||e[s+2]>a)&&(r.numSimplified++,u.push(e[s]),u.push(e[s+1])),r.numPoints++;o&&function(t,e){for(var r=0,n=0,o=t.length,i=o-2;n<o;i=n,n+=2)r+=(t[n]-t[i])*(t[n+1]+t[i+1]);if(r>0===e)for(var a=0,u=t.length;a<u/2;a+=2){var s=t[a],l=t[a+1];t[a]=t[u-2-a],t[a+1]=t[u-1-a],t[u-2-a]=s,t[u-1-a]=l}}(u,i),t.push(u)}}function Ct(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i=[],a=!0,u=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Dt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Dt(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Dt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Et(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ut(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var zt=function(){function t(e,r){for(var n in function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Ut(this,"minZoom",0),Ut(this,"maxZoom",20),Ut(this,"faces",new Set),Ut(this,"indexMaxZoom",4),Ut(this,"indexMaxPoints",1e5),Ut(this,"tolerance",3),Ut(this,"extent",8192),Ut(this,"buffer",64),Ut(this,"promoteId",null),Ut(this,"generateId",!1),Ut(this,"tiles",{}),r)this[n]=r[n];if(this.maxZoom<0||this.maxZoom>20)throw new Error("maxZoom should be in the 0-24 range");if(this.promoteId&&this.generateId)throw new Error("promoteId and generateId cannot be used together.");var o=function(t,e){var r=[];if("S2FeatureCollection"===t.type)for(var n=0;n<t.features.length;n++)ut(r,t.features[n],e,n);else{if("S2Feature"!==t.type)throw Error("Incompatible data type");ut(r,t,e)}return r}(e,this),i=[[],[],[],[],[],[]];o.forEach((function(t){return i[t.face].push(t)}));for(var a=0;a<6;a++)i[a].length&&(this.faces.add(a),this.splitTile(i[a],q(a)))}var e,r;return e=t,(r=[{key:"splitTile",value:function(t,e,r,n){for(var o,i,a,u,s=[t,e];s.length;){var l=s.pop();t=s.pop();var c=this.tiles[l];if(c||(c=this.tiles[l]=_t(t,l,this)),(r||!(c.zoom===this.indexMaxZoom||c.numPoints<=this.indexMaxPoints))&&(!r||c.zoom!==n&&(o=r,void 0,void 0,void 0,a=(i=P(W(l),2))[0],u=i[1],o>=a&&o<=u))&&c.zoom!==this.maxZoom&&(c.source=null,0!==t.length)){var f=Ct(vt(t,c,this),4),h=f[0],p=f[1],y=f[2],v=f[3],d=Ct(R(E(l),c.zoom,c.i,c.j),4),m=d[0],b=d[1],g=d[2],w=d[3];s.push(h,m),s.push(p,b),s.push(y,g),s.push(v,w)}}}},{key:"getTile",value:function(t){var e=z(t);if(e<0||e>24||!this.faces.has(E(t)))return null;if(this.tiles[t])return Pt(this.tiles[t],this.extent);for(var r,n=t;!r&&!U(n);)n=L(n),r=this.tiles[n];return r&&r.source?(this.splitTile(r.source,n,t,e),this.tiles[t]?Pt(this.tiles[t],this.extent):null):null}}])&&Et(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Rt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i=[],a=!0,u=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Lt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Lt(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Lt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Wt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Nt(t,e,r,n,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,o)}function Ft(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Nt(i,n,o,a,u,"next",t)}function u(t){Nt(i,n,o,a,u,"throw",t)}a(void 0)}))}}function Bt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Gt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var $t=function(){function t(e,r,n,o,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Gt(this,"ready",!1),Gt(this,"active",!0),Gt(this,"name",void 0),Gt(this,"path",void 0),Gt(this,"type","vector"),Gt(this,"extension",void 0),Gt(this,"encoding",void 0),Gt(this,"isTimeFormat",!1),Gt(this,"attributions",{}),Gt(this,"styleLayers",void 0),Gt(this,"layers",void 0),Gt(this,"minzoom",0),Gt(this,"maxzoom",20),Gt(this,"faces",void 0),Gt(this,"needsToken",!1),Gt(this,"time",void 0),Gt(this,"session",void 0),Gt(this,"requestCache",[]),this.name=e,this.styleLayers=r,this.path=n,this.needsToken=o,this.session=i}var e,r,n,i,a;return e=t,r=[{key:"build",value:(a=Ft(o().mark((function t(e,r){var n;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this,r){t.next=5;break}return t.next=4,this._fetch("".concat(this.path,"/metadata.json"),e);case 4:r=t.sent;case 5:r?n._buildMetadata(r,e):(n.active=!1,console.log("FAILED TO extrapolate ".concat(this.path," metadata")));case 6:case"end":return t.stop()}}),t,this)}))),function(t,e){return a.apply(this,arguments)})},{key:"_buildMetadata",value:function(t,e){if(this.active=!0,t.minzoom&&(this.minzoom=t.minzoom),t.maxzoom&&(this.maxzoom=Math.min(t.maxzoom,this.maxzoom)),t.faces&&(this.faces=new Set(t.faces)),t.extension&&(this.extension=t.extension),t.attributions&&(this.attributions=t.attributions),t.type?this.type=t.type:(this.active=!1,console.log('Failed to acquire "type" from metadata')),t.encoding&&(this.encoding=t.encoding),t.layers){for(var r=t.layers,n=0,o=Object.values(r);n<o.length;n++)delete o[n].fields;this.layers=r}t.format&&(this.isTimeFormat="tfzxy"===t.format),this.isTimeFormat&&postMessage({mapID:e,type:"timesource",sourceName:this.name,interval:t.interval}),this.ready=!0,this._checkCache();var i=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Wt(Object(r),!0).forEach((function(e){Gt(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Wt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},this.attributions);Object.keys(i).length&&postMessage({mapID:e,type:"attributions",attributions:i})}},{key:"_checkCache",value:function(){for(;this.requestCache.length;){var t=Rt(this.requestCache.pop(),3),e=t[0],r=t[1],n=t[2];this.tileRequest(e,r,n)}}},{key:"tileRequest",value:function(t,e,r){if(this.ready){var n=this.active,o=this.minzoom,i=this.maxzoom,a=this.faces,u=this.name,s=e.face,l=e.zoom,c=e.id;n&&o<=l&&i>=l&&(!a||a.has(s))?this._tileRequest(t,e,u,null,r):this._flush(t,c,u),this._getParentData(t,e,r)}else this.requestCache.push([t,e,r])}},{key:"_getParentData",value:function(t,e,r){for(var n=this.layers,o=this.styleLayers,i=this.name,a=e.time,u=e.face,s=e.zoom,l=e.id,c={},f=0,h=o.length;f<h;f++){var p=o[f];if(n){var y=n[p.layer];if(p.maxzoom>s&&y&&y.maxzoom<s){for(var v=y.maxzoom,d=s,m=l;d>v;)d--,m=L(m);var b=Rt(D(m,d),3),g=b[1],w=b[2];c[m]||(c[m]={time:a,face:u,id:m,zoom:d,i:g,j:w,layers:[]}),c[m].layers.push(p.layerIndex)}}}if(Object.keys(c).length)for(var x=0,k=Object.entries(c);x<k.length;x++){var S=Rt(k[x],2),j=S[0],O=S[1];this._tileRequest(t,e,"".concat(i,":").concat(j),O,r)}}},{key:"_tileRequest",value:(i=Ft(o().mark((function t(e,r,n,i,a){var u,s,l,c,f,h,p,y,v,d,m,b;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u=this.path,s=this.session,l=this.type,c=this.extension,h=(f=i||r).time,p=f.face,y=f.zoom,v=f.i,d=f.j,m="".concat(h?h+"/":"").concat(p,"/").concat(y,"/").concat(v,"/").concat(d,".").concat(c),t.next=5,this._fetch("".concat(u,"/").concat(m),e);case 5:(b=t.sent)?s.requestWorker().postMessage({mapID:e,type:l,tile:r,parent:i,sourceName:n,data:b,layerIndexes:a},[b]):this._flush(e,id,n);case 7:case"end":return t.stop()}}),t,this)}))),function(t,e,r,n,o){return i.apply(this,arguments)})},{key:"_flush",value:function(t,e,r){postMessage({mapID:t,tileID:e,source:r,type:"flush",fill:!1,line:!1,point:!1,heatmap:!1,glyph:!1})}},{key:"_fetch",value:(n=Ft(o().mark((function t(e,r){var n,i,a,u,s=arguments;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=s.length>2&&void 0!==s[2]&&s[2],i={},t.next=4,this.session.requestSessionToken(r);case 4:return a=t.sent,this.needsToken&&a&&(i.Authorization=a),t.next=8,fetch(e,{headers:i});case 8:if(200===(u=t.sent).status||206===u.status){t.next=11;break}return t.abrupt("return",null);case 11:if(!n&&!u.headers.get("content-type").includes("application/json")){t.next=13;break}return t.abrupt("return",u.json());case 13:return t.abrupt("return",u.arrayBuffer());case 14:case"end":return t.stop()}}),t,this)}))),function(t,e){return n.apply(this,arguments)})}],r&&Bt(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Kt(t){return Kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kt(t)}function Zt(t,e,r,n,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,o)}function Ht(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Vt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Yt(t,e){return Yt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Yt(t,e)}function Jt(t,e){if(e&&("object"===Kt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Xt(t)}function Xt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Qt(t){return Qt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Qt(t)}function te(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var ee=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");Object.defineProperty(t,"prototype",{value:Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),writable:!1}),e&&Yt(t,e)}(l,t);var e,r,n,i,a,u,s=(a=l,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Qt(a);if(u){var r=Qt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Jt(this,t)});function l(){var t;Ht(this,l);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return te(Xt(t=s.call.apply(s,[this].concat(r))),"s2json",void 0),t}return e=l,r=[{key:"build",value:(n=o().mark((function t(e){var r,n;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this,t.next=3,this._fetch("".concat(this.path),e,!0);case 3:(n=t.sent)?(r.s2json=new zt(n),this._buildMetadata({type:"vector"},e)):(r.active=!1,console.log("FAILED TO extrapolate ".concat(this.path," json data")));case 5:case"end":return t.stop()}}),t,this)})),i=function(){var t=this,e=arguments;return new Promise((function(r,o){var i=n.apply(t,e);function a(t){Zt(i,r,o,a,u,"next",t)}function u(t){Zt(i,r,o,a,u,"throw",t)}a(void 0)}))},function(t){return i.apply(this,arguments)})},{key:"_tileRequest",value:function(t,e){var r=this.name,n=this.s2json,o=this.session,i=e.id,a=e.face;if(n.faces.has(a)){var u=n.getTile(i);if(!u||!u.layers||!u.layers.default)return this._flush(t,i,r);u=new TextEncoder("utf-8").encode(JSON.stringify(u)).buffer,o.requestWorker().postMessage({mapID:t,type:"jsondata",tile:e,sourceName:r,data:u},[u])}}},{key:"_getParentData",value:function(){}}],r&&Vt(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),l}($t);function re(t){return re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},re(t)}function ne(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function oe(t,e,r,n,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,o)}function ie(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){oe(i,n,o,a,u,"next",t)}function u(t){oe(i,n,o,a,u,"throw",t)}a(void 0)}))}}function ae(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ue(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function se(t,e,r){return e&&ue(t.prototype,e),r&&ue(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function le(){return le="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=ce(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},le.apply(this,arguments)}function ce(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ge(t)););return t}function fe(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");Object.defineProperty(t,"prototype",{value:Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),writable:!1}),e&&be(t,e)}function he(t){var e=me();return function(){var r,n=ge(t);if(e){var o=ge(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return pe(this,r)}}function pe(t,e){if(e&&("object"===re(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return ye(t)}function ye(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ve(t){var e="function"==typeof Map?new Map:void 0;return ve=function(t){if(null===t||(r=t,-1===Function.toString.call(r).indexOf("[native code]")))return t;var r;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return de(t,arguments,ge(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),be(n,t)},ve(t)}function de(t,e,r){return de=me()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var o=new(Function.bind.apply(t,n));return r&&be(o,r.prototype),o},de.apply(null,arguments)}function me(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function be(t,e){return be=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},be(t,e)}function ge(t){return ge=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ge(t)}function we(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var xe=15e5,ke=function(t){fe(r,t);var e=he(r);function r(){var t;ae(this,r);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return we(ye(t=e.call.apply(e,[this].concat(o))),"order",[]),t}return se(r,[{key:"set",value:function(t,e){for(this.order.unshift(t);this.order.length>7;)this.delete(this.order.pop());return le(ge(r.prototype),"set",this).call(this,t,e)}},{key:"get",value:function(t){return this.order.splice(this.order.indexOf(t),1),this.order.unshift(t),le(ge(r.prototype),"get",this).call(this,t)}},{key:"delete",value:function(t){return le(ge(r.prototype),"delete",this).call(this,t)}}]),r}(ve(Map)),Se=function(t){fe(s,t);var e,r,n,i,a,u=he(s);function s(){var t;ae(this,s);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return we(ye(t=u.call.apply(u,[this].concat(r))),"version",1),we(ye(t),"rootDir",{}),we(ye(t),"dirCache",new ke),t}return se(s,[{key:"build",value:(a=ie(o().mark((function t(e){var r,n,i,a,u,s,l,c,f;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this,t.next=3,this.getRange("".concat(this.path,"?type=dir"),0,81920,e);case 3:if((n=t.sent)&&81920===n.byteLength){t.next=8;break}return r.active=!1,console.log("Failed to extrapolate ".concat(this.path," metadata")),t.abrupt("return");case 8:if(12883===(i=new DataView(n,0,20)).getUint16(0,!0)){t.next=13;break}return r.active=!1,console.log("Bad metadata from ".concat(this.path)),t.abrupt("return");case 13:if(this.version=i.getUint16(2,!0),a=i.getUint32(4,!0),u=je(i,8),0!==a&&0!==u){t.next=20;break}return r.active=!1,console.log("Failed to extrapolate ".concat(this.path," metadata")),t.abrupt("return");case 20:for(s=0,l=[0,1,2,3,4,5];s<l.length;s++)c=l[s],this.rootDir[c]=new DataView(n,20+13650*c,13650);return t.next=23,this.getRange("".concat(this.path,"?type=metadata"),u,a,e);case 23:f=t.sent,this._buildMetadata(f,e);case 25:case"end":return t.stop()}}),t,this)}))),function(t){return a.apply(this,arguments)})},{key:"_tileRequest",value:(i=ie(o().mark((function t(e,r,n,i,a){var u,s,l,c,f,h,p,y,v,d,m,b;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u=this.type,s=this.encoding,l=this.session,f=(c=i||r).face,h=c.id,p=c.zoom,y=c.i,v=c.j,d=this.rootDir[f],t.next=5,this._walk(e,d,p,y,v);case 5:if(m=t.sent){t.next=8;break}return t.abrupt("return",this._flush(e,h,n));case 8:return t.next=10,this.getRange("".concat(this.path,"?type=tile&enc=").concat(s),m[0],m[1],e);case 10:if(!(b=t.sent)){t.next=16;break}l.requestWorker().postMessage({mapID:e,type:u,tile:r,sourceName:n,parent:i,data:b,layerIndexes:a},[b]),t.next=17;break;case 16:return t.abrupt("return",this._flush(e,h,n));case 17:case"end":return t.stop()}}),t,this)}))),function(t,e,r,n,o){return i.apply(this,arguments)})},{key:"_walk",value:(n=ie(o().mark((function t(e,r,n,i,a){var u,s,l,c,f;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:u=this.maxzoom,s=Oe(n,i,a);case 2:if(!s.length){t.next=18;break}if(f=10*s.shift(),l=je(r,f),c=r.getUint32(f+6,!0)){t.next=8;break}return t.abrupt("return",null);case 8:if(!s.length){t.next=16;break}if(u%5!=0||n!==u||1!==s.length||0!==s[0]){t.next=11;break}return t.abrupt("return",[l,c]);case 11:return t.next=13,this._getDir(e,l,c);case 13:if(r=t.sent){t.next=16;break}return t.abrupt("return",null);case 16:t.next=2;break;case 18:if(c&&!(c>xe)){t.next=20;break}return t.abrupt("return",null);case 20:return t.abrupt("return",[l,c]);case 21:case"end":return t.stop()}}),t,this)}))),function(t,e,r,o,i){return n.apply(this,arguments)})},{key:"_getDir",value:(r=ie(o().mark((function t(e,r,n){var i,a;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.dirCache.has(r)){t.next=2;break}return t.abrupt("return",this.dirCache.get(r));case 2:return t.next=4,this.getRange("".concat(this.path,"?type=dir"),r,n,e);case 4:if(!(i=t.sent)){t.next=9;break}return a=new DataView(i),this.dirCache.set(r,a),t.abrupt("return",a);case 9:return t.abrupt("return",null);case 10:case"end":return t.stop()}}),t,this)}))),function(t,e,n){return r.apply(this,arguments)})},{key:"getRange",value:(e=ie(o().mark((function t(e,r,n,i){var a,u,s,l,c,f,h;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=this.needsToken,u=this.type,s=this.session,l={Accept:"application/x-protobuf,image/webp,application/json"},c=r+"-"+(r+n-1),t.t0=a,!t.t0){t.next=8;break}return t.next=7,s.requestSessionToken(i);case 7:t.t0=t.sent;case 8:if((f=t.t0)&&(l.Authorization=f),!(0===n||n>xe)){t.next=12;break}return t.abrupt("return",null);case 12:return t.next=14,fetch("".concat(e,"&bytes=").concat(c,"&subtype=").concat(u),{headers:l});case 14:if(200===(h=t.sent).status||206===h.status){t.next=17;break}return t.abrupt("return",null);case 17:if("application/json"!==h.headers.get("content-type")){t.next=19;break}return t.abrupt("return",h.json());case 19:return t.abrupt("return",h.arrayBuffer());case 20:case"end":return t.stop()}}),t,this)}))),function(t,r,n,o){return e.apply(this,arguments)})}]),s}($t),je=function(t,e){return 65536*t.getUint32(e+2,!0)+t.getUint16(e,!0)},Oe=function(t,e,r){for(var n=Math.max,o=Math.pow,i=[];t>=5;)i.push([5,31&e,31&r]),e>>=5,r>>=5,t=n(0,t-5);return i.push([t,e,r]),i.map((function(t){var e=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i=[],a=!0,u=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return ne(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ne(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t,3),r=e[0],n=e[1],i=0;for(i+=e[2]*(1<<r)+n;r--;)i+=o(1<<r,2);return i}))};function Pe(t){return t.replace("s2maps://","".concat("http://localhost:8787/v1","/"))}function Me(t,e,r,n,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,o)}function Ae(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Me(i,n,o,a,u,"next",t)}function u(t){Me(i,n,o,a,u,"throw",t)}a(void 0)}))}}function Ie(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _e(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Te="http://localhost:8787/v1",qe=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),_e(this,"analytics",void 0),_e(this,"sessionKeys",{}),_e(this,"workers",[]),_e(this,"currWorker",0),_e(this,"totalWorkers",0),_e(this,"sessionPromise",null)}var e,r,n,i,a;return e=t,r=[{key:"loadStyle",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;this.sessionKeys[e]||(this.analytics=t,this.sessionKeys[e]={apiKey:r})}},{key:"loadWorker",value:function(t,e,r){this.totalWorkers++,this.workers[r]=e}},{key:"requestWorker",value:function(){var t=this.workers[this.currWorker];return this.currWorker++,this.currWorker>=this.totalWorkers&&(this.currWorker=0),t}},{key:"requestStyle",value:(a=Ae(o().mark((function t(e,r){var n,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.requestSessionToken(e);case 2:if(n=t.sent){t.next=5;break}return t.abrupt("return");case 5:(i=fetch(Pe(r),{headers:{Authorization:n}}).then((function(t){return 200!==t.status?null:t.json()})).catch((function(t){return console.error(t),null})))&&postMessage({type:"setStyle",mapID:e,style:i,ignorePosition:!1});case 7:case"end":return t.stop()}}),t,this)}))),function(t,e){return a.apply(this,arguments)})},{key:"getInfo",value:(i=Ae(o().mark((function t(e,r){var n,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.requestSessionToken(e);case 2:if(n=t.sent){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,fetch("".concat(Te,"/info/").concat(r,".json"),{headers:{Authorization:n}}).then((function(t){return 200!==t.status?null:t.json()})).catch((function(t){return console.error(t),null}));case 7:(i=t.sent)&&postMessage({mapID:e,type:"info",json:i});case 9:case"end":return t.stop()}}),t,this)}))),function(t,e){return i.apply(this,arguments)})},{key:"requestSessionToken",value:(n=Ae(o().mark((function t(e){var r,n,i,a,u,s,l,c,f,h,p;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((r=this.sessionKeys[e])&&r.apiKey){t.next=3;break}return t.abrupt("return",null);case 3:if(n=r.apiKey,i=r.token,!((a=r.exp)&&i&&a-(new Date).getTime()>0)){t.next=6;break}return t.abrupt("return",i);case 6:return u=this.analytics,s=u.gpu,l=u.context,c=u.language,f=u.width,h=u.height,this.sessionPromise||(this.sessionPromise=fetch("".concat(Te,"/session"),{method:"POST",body:JSON.stringify({apiKey:n,gpu:s,context:l,language:c,width:f,height:h}),headers:{"Content-Type":"application/json"}}).then((function(t){return 200!==t.status&&206!==t.status?null:t.json()})).then((function(t){var e=new Date;return e.setSeconds(e.getSeconds()+t.maxAge),t.token?{token:t.token,exp:e.getTime()}:null})).catch((function(t){return console.error(t),null}))),t.next=10,this.sessionPromise;case 10:if(p=t.sent,this.sessionPromise=null,p){t.next=14;break}return t.abrupt("return",null);case 14:return r.token=p.token,r.exp=p.exp,t.abrupt("return",r.token);case 17:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})}],r&&Ie(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Ce(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function De(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Ee=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),De(this,"height",0),De(this,"maxWidth",2048),De(this,"spaces",{})}var e,r;return e=t,(r=[{key:"addGlyph",value:function(t,e){var r=[0,0,t,e];(!this.spaces[e]||this.spaces[e].widthOffset+t>this.maxWidth)&&(this.spaces[e]={heightOffset:this.height+1,widthOffset:0},this.height+=e+1);var n=this.spaces[e],o=n.widthOffset,i=n.heightOffset;return r[0]=o,r[1]=i,this.spaces[e].widthOffset+=t+1,[r[0],r[1]]}}])&&Ce(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Ue(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=Be(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}function ze(t){return ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ze(t)}function Re(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Le(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Re(Object(r),!0).forEach((function(e){Ke(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Re(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function We(t,e,r,n,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,o)}function Ne(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){We(i,n,o,a,u,"next",t)}function u(t){We(i,n,o,a,u,"throw",t)}a(void 0)}))}}function Fe(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i=[],a=!0,u=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}}(t,e)||Be(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Be(t,e){if(t){if("string"==typeof t)return Ge(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ge(t,e):void 0}}function Ge(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function $e(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ke(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var Ze=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Ke(this,"workers",[]),Ke(this,"session",new qe),Ke(this,"layers",{}),Ke(this,"sources",{}),Ke(this,"glyphs",{}),Ke(this,"texturePack",new Ee)}var e,r,n,i,a;return e=t,r=[{key:"onMessage",value:function(t){var e=t.data,r=e.mapID,n=e.type;"port"===n?this._loadWorkerPort(e.messagePort,e.postPort,e.id):"requestStyle"===n?this._requestStyle(r,e.style,e.apiKey,e.analytics):"style"===n?this._loadStyle(r,e.style):"tilerequest"===n?this._request(r,e.tiles,e.sources):"timerequest"===n?this._requestTime(r,e.tiles,e.sourceNames):"glyphrequest"===n?this._glyphRequest(r,e.id,e.reqID,e.glyphList,e.iconList):"getInfo"===n?this._getInfo(r,e.featureID):"addMarkers"===n?this._addMarkers(r,e.markers,e.sourceName):"removeMarkers"===n?this._removeMarkers(r,e.ids,e.sourceName):"deleteSource"===n?this._deleteSource(r,e.sourceNames):"addLayer"===n?this._addLayer(r,e.layer,e.index):"removeLayer"===n?this._removeLayer(r,e.index):"reorderLayers"===n&&this._reorderLayers(r,e.layerChanges)}},{key:"_loadWorkerPort",value:function(t,e,r){this.workers[r]=e,t.onmessage=this.onMessage.bind(this),this.session.loadWorker(t,e,r)}},{key:"_requestStyle",value:function(t,e,r,n){this.session.loadStyle(n,t,r),this.session.requestStyle(t,e)}},{key:"_loadStyle",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.sources[t]={};var r=e.sources,n=e.layers,o=e.fonts,i=e.icons,a=e.glyphs,u=e.analytics,s=e.apiKey;this.layers[t]=n,this.session.loadStyle(u,t,s),this._buildSources(t,r,n,o,i,a)}},{key:"_addLayer",value:function(t,e,r){var n=this.layers[t];n.splice(r,0,e);for(var o=r+1,i=n.length;o<i;o++){var a=n[o];a.layerIndex++,a.depthPos++}}},{key:"_removeLayer",value:function(t,e){var r=this.layers[t];r.splice(e,1);for(var n=e,o=r.length;n<o;n++){var i=r[n];i.layerIndex--,i.depthPos--}}},{key:"_reorderLayers",value:function(t,e){for(var r=this.layers[t],n=[],o=0,i=Object.entries(e);o<i.length;o++){var a=Fe(i[o],2),u=a[0],s=a[1],l=r[+u];l.layerIndex=s,l.depthPos=s+1,n[s]=l}for(var c=0;c<r.length;c++)r[c]=n[c]}},{key:"_buildSources",value:(a=Ne(o().mark((function t(e){var r,n,i,a,u,s,l,c,f,h,p,y,v,d,m,b,g,w,x=this,k=arguments;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(r=k.length>1&&void 0!==k[1]?k[1]:{},n=k.length>2?k[2]:void 0,i=k.length>3&&void 0!==k[3]?k[3]:{},a=k.length>4&&void 0!==k[4]?k[4]:{},u=k.length>5&&void 0!==k[5]?k[5]:{},s=function(){var t=Fe(c[l],2),r=t[0],o=t[1];x._createSource(e,r,o,n.filter((function(t){return t.source===r})))},l=0,c=Object.entries(r);l<c.length;l++)s();for(f=0,h=Object.entries(Le(Le(Le({},i),a),u));f<h.length;f++)p=Fe(h[f],2),y=p[0],"object"===ze(v=p[1])?this._createGlyphSource(e,y,v.path,v.fallback):this._createGlyphSource(e,y,v);for(d=0,m=Object.entries(this.glyphs);d<m.length;d++)b=Fe(m[d],2),g=b[1],(w=g.fallback)&&(g.fallback=this.glyphs[w]);case 9:case"end":return t.stop()}}),t,this)}))),function(t){return a.apply(this,arguments)})},{key:"_createSource",value:function(t,e,r,n){var o,i=this.session;"object"===ze(r)&&(o=r,r=r.path);var a,u=r.split(".").pop().toLowerCase(),s=r.includes("s2maps://"),l=s?Pe(r):r;a="s2tiles"===u?new Se(e,n,l,s,i):"s2json"===u?new ee(e,n,l,s,i):"tile"===r?new w(e,n):new $t(e,n,l,s,i),this.sources[t][e]=a,a.build(t,o)}},{key:"_createGlyphSource",value:function(t,e,r,n){var o=this.texturePack,i=this.session,a=r.includes("s2maps://"),u=a?Pe(r):r;if(!this.glyphs[e]){var s=new m(e,u,n,o,a,i);this.glyphs[e]=s,s.build(t)}}},{key:"_request",value:(i=Ne(o().mark((function t(e,r){var n,i,a,u,s,l,c,f,h,p,y,v,d,m,b,g,w=arguments;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=w.length>2&&void 0!==w[2]?w[2]:[],i=n.filter((function(t){return t[1]})),a=n.map((function(t){return t[0]})),u=Ue(i);try{for(u.s();!(s=u.n()).done;)l=Fe(s.value,2),c=l[0],f=l[1],(h=this.sources[e]&&this.sources[e][c])&&(p=h.styleLayers,this._createSource(e,c,f,p))}catch(t){u.e(t)}finally{u.f()}y=Ue(r),t.prev=6,y.s();case 8:if((v=y.n()).done){t.next=23;break}d=v.value,m=0,b=Object.values(this.sources[e]);case 11:if(!(m<b.length)){t.next=21;break}if(g=b[m],!a.length||a.includes(g.name)){t.next=15;break}return t.abrupt("continue",18);case 15:if(!g.isTimeFormat){t.next=17;break}return t.abrupt("continue",18);case 17:g.tileRequest(e,d);case 18:m++,t.next=11;break;case 21:t.next=8;break;case 23:t.next=28;break;case 25:t.prev=25,t.t0=t.catch(6),y.e(t.t0);case 28:return t.prev=28,y.f(),t.finish(28);case 31:case"end":return t.stop()}}),t,this,[[6,25,28,31]])}))),function(t,e){return i.apply(this,arguments)})},{key:"_requestTime",value:(n=Ne(o().mark((function t(e,r,n){var i,a,u,s,l,c;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=Ue(r),t.prev=1,i.s();case 3:if((a=i.n()).done){t.next=16;break}u=a.value,s=0,l=Object.values(this.sources[e]);case 6:if(!(s<l.length)){t.next=14;break}if((c=l[s]).isTimeFormat&&n.includes(c.name)){t.next=10;break}return t.abrupt("continue",11);case 10:c.tileRequest(e,u);case 11:s++,t.next=6;break;case 14:t.next=3;break;case 16:t.next=21;break;case 18:t.prev=18,t.t0=t.catch(1),i.e(t.t0);case 21:return t.prev=21,i.f(),t.finish(21);case 24:case"end":return t.stop()}}),t,this,[[1,18,21,24]])}))),function(t,e,r){return n.apply(this,arguments)})},{key:"_glyphRequest",value:function(t,e,r,n,o){for(var i=this.workers,a=0,u=Object.entries(n);a<u.length;a++){var s=Fe(u[a],2),l=s[0],c=s[1];this.glyphs[l].glyphRequest(new Uint16Array(c),t,r,i[e])}for(var f=0,h=Object.entries(o);f<h.length;f++){var p=Fe(h[f],2),y=p[0],v=p[1];this.glyphs[y].iconRequest(v,t,r,i[e])}}},{key:"_getInfo",value:function(t,e){this._createSource(t,"_info","s2maps://info/".concat(e,".s2json")),this.session.getInfo(t,e)}},{key:"_addMarkers",value:function(t,e,r){this.sources[t][r]||(this.sources[t][r]=new Y(r,this.session)),this.sources[t][r].addMarkers(e)}},{key:"_removeMarkers",value:function(t,e,r){this.sources[t][r]||(this.sources[t][r]=new Y(r,this.session)),this.sources[t][r].removeMarkers(e)}},{key:"_deleteSource",value:function(t,e){var r,n=Ue(e);try{for(n.s();!(r=n.n()).done;){var o=r.value;delete this.sources[t][o]}}catch(t){n.e(t)}finally{n.f()}}}],r&&$e(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}(),He=new Ze;onmessage=He.onMessage.bind(He)}},n={};function o(t){var e=n[t];if(void 0!==e)return e.exports;var i=n[t]={id:t,loaded:!1,exports:{}};return r[t](i,i.exports,o),i.loaded=!0,i.exports}o.m=r,o.x=()=>{var t=o.O(void 0,[840],(()=>o(992)));return o.O(t)},t=[],o.O=(e,r,n,i)=>{if(!r){var a=1/0;for(c=0;c<t.length;c++){for(var[r,n,i]=t[c],u=!0,s=0;s<r.length;s++)(!1&i||a>=i)&&Object.keys(o.O).every((t=>o.O[t](r[s])))?r.splice(s--,1):(u=!1,i<a&&(a=i));if(u){t.splice(c--,1);var l=n();void 0!==l&&(e=l)}}return e}i=i||0;for(var c=t.length;c>0&&t[c-1][2]>i;c--)t[c]=t[c-1];t[c]=[r,n,i]},o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var r in e)o.o(e,r)&&!o.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},o.f={},o.e=t=>Promise.all(Object.keys(o.f).reduce(((e,r)=>(o.f[r](t,e),e)),[])),o.u=t=>t+".min.js",o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),o.p="http://localhost:3000/s2maps-gl/v0.3.3-dev/",(()=>{var t={13:1};o.f.i=(e,r)=>{t[e]||importScripts(o.p+o.u(e))};var e=this.webpackChunk=this.webpackChunk||[],r=e.push.bind(e);e.push=e=>{var[n,i,a]=e;for(var u in i)o.o(i,u)&&(o.m[u]=i[u]);for(a&&a(o);n.length;)t[n.pop()]=1;r(e)}})(),e=o.x,o.x=()=>o.e(840).then(e),o.x()})();